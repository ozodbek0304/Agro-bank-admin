/**
* Copyright (c) 2024, Yandex LLC
* All rights reserved. (MIT Licensed)
*
* Yagr@4.3.0
* High-performance HTML5 canvas chart renderer based on uPlot
* https://github.com/gravity-ui/yagr
*/

"use strict";(()=>{var Vo=Object.defineProperty,Ho=(e,t)=>{for(var s in t)Vo(e,s,{get:t[s],enumerable:!0})},Nn={};Ho(Nn,{AXIS_LABEL_FONT:()=>Pi,AXIS_VALUES_FONT:()=>Fi,BARS_DRAW_FACTOR:()=>sl,BARS_DRAW_MAX:()=>il,CURSOR_STYLE:()=>Ni,DARK_DEFAULT_LINE_COLOR:()=>$n,DAY:()=>Ke,DECADE:()=>Uo,DEFAULT_AXIS_FONT_SIZE:()=>Wn,DEFAULT_CANVAS_PIXEL_RATIO:()=>Qe,DEFAULT_FOCUS_ALPHA:()=>zn,DEFAULT_LOGARITHMIC_MIN_SCALE_VALUE:()=>Ri,DEFAULT_MAX_TICKS:()=>Vn,DEFAULT_POINT_SIZE:()=>Ts,DEFAULT_SCALE_MIN_RANGE:()=>Hn,DEFAULT_SYNC_KEY:()=>Un,DEFAULT_TITLE_FONT_SIZE:()=>Bn,DEFAULT_X_SCALE:()=>Te,DEFAULT_X_SERIE_NAME:()=>Oi,DEFAULT_Y_AXIS_LABEL_PADDING:()=>Kn,DEFAULT_Y_AXIS_OFFSET:()=>Mi,DEFAULT_Y_AXIS_PADDING:()=>Xn,DEFAULT_Y_AXIS_SIZE:()=>jn,DEFAULT_Y_SCALE:()=>ht,HOUR:()=>It,LIGHT_DEFAULT_LINE_COLOR:()=>Gn,MARKER_DIAMETER:()=>ul,MINUTE:()=>Nt,MIN_SELECTION_WIDTH:()=>fl,PADDING_BOTH:()=>rl,PADDING_LEFT:()=>nl,PADDING_RIGHT:()=>ll,SECOND:()=>yt,SERIE_AREA_BORDER_COLOR:()=>al,SERIE_AREA_BORDER_WIDTH:()=>cl,SERIE_COLOR:()=>ol,SERIE_LINE_WIDTH:()=>Ci,TIME_MULTIPLIER:()=>As,TOOLTIP_DEFAULT_MAX_LINES:()=>gl,TOOLTIP_X_OFFSET:()=>dl,TOOLTIP_Y_OFFSET:()=>pl,TYPES_ORDER:()=>Bo,X_AXIS_INCRS:()=>tl,X_AXIS_SIZE:()=>Qn,X_AXIS_SPACE:()=>el,X_AXIS_TICK_GAP:()=>Jn,YEAR:()=>zt,Y_AXIS_LABEL_SIZE:()=>Zn,Y_AXIS_SIZE:()=>qn,Y_AXIS_TICK_GAP:()=>Yn,default:()=>hl});var Oi="date",Te="x",ht="y",zn=.3,Qe=typeof window>"u"?1:window.devicePixelRatio,Vn=5,Mi=.05,Hn=.01,Ri=.001,Ts=Qe>=2?4:2,Un="sync",Bn=14,Gn="#222222",$n="#eeeeee",Wn=11,Pi="normal 11px Lucida Grande, Arial, Helvetica, sans-serif",Fi="11px Lucida Grande, Arial, Helvetica, sans-serif",Yn=6,jn=12,Xn=12,Kn=2,qn=(e,t,s)=>{if(!t)return jn;const i=t.reduce((c,f)=>c.length>f.length?c:f),{ctx:n}=e;n.save();const r=e.axes[s];n.font=r.font?r.font[0]:Fi;const{width:o}=n.measureText(i);n.restore();let u=0;if(r.label){u=r.labelSize||Wn,n.font=r.labelFont?r.labelFont[0]:Pi;const{fontBoundingBoxAscent:c}=n.measureText(r.label);u=c,n.restore()}return u?o/Qe+u/Qe+Kn:o/Qe+Xn},Zn=11,yt=1e3,Nt=yt*60,It=Nt*60,Ke=It*24,zt=Ke*365,Uo=zt*10,Jn=6,Qn=32,el=80,tl=[1,10,50,100,200,500,yt,yt*2,yt*5,yt*10,yt*15,yt*30,Nt,Nt*5,Nt*10,Nt*30,It,It*2,It*3,It*4,It*6,It*12,Ke,Ke*2,Ke*3,Ke*5,Ke*10,Ke*15,Ke*30,Ke*60,Ke*120,Ke*180,zt,zt*2,zt*5,zt*10],Bo=["dots","line","area","column"],sl=.5,il=100,nl=[14,14,0,4],ll=[14,4,0,14],rl=[14,4,0,4],ol="rgba(0, 0, 0, 1)",Ci=2,al="rgba(0, 0, 0, 0.2)",cl=1,ul=8,Ni="1px solid #ffa0a0",fl=15,Go=.68,$o=-.6,hl=class{constructor(e,t="light"){this.setTheme(t),this.colors=e}setTheme(e){this.theme=e}get GRID(){return{show:!0,stroke:()=>this.colors.parse("--yagr-grid"),width:1}}get X_AXIS_TICKS(){return{size:8,...this.GRID}}get Y_AXIS_TICKS(){return{size:6,...this.GRID}}get AXIS_STROKE(){return this.colors.parse("--yagr-axis-stroke")}get BACKGROUND(){return this.colors.parse("--yagr-background")}get SHIFT(){return this.theme?.startsWith("light")?Go:$o}get DEFAULT_LINE_COLOR(){return this.theme?.startsWith("light")?Gn:$n}},pl=24,dl=24,gl=10,As=1,Wo=[0,0,0,.6],Js=class{static parseRgba(e){const t=e.match(/rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,?\s*(\d+\.?\d*)?\s*\)/);return t?[t[1],t[2],t[3],t[4]||1].map(Number):null}parse(e="000"){const t=e.startsWith("var(--");let s=e,i=!0,n;const r=this.context,o=r.style.color;return t||e.startsWith("--")?(i=!1,n=t?e.slice(4,-1):e):!e.startsWith("#")&&!e.startsWith("rgb")&&(r.style.color=e,n="color",i=!1),s=i?s:getComputedStyle(r).getPropertyValue(n),r.style.color=o,s}setContext(e){this.context=e}rgba(e){return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}toRgba(e,t){return Js.parseRgba(this.parse(e))||t}shade([e,t,s,i],n){const r=n<0,o=r?0:255*n,u=r?1+n:1-n,c=Math.round(e*u+o),f=Math.round(t*u+o),p=Math.round(s*u+o);return"rgba("+c+","+f+","+p+","+i+")"}},Yo=(e,t)=>{const s=e.utils.theme.SHIFT,i=e.uplot.series[t],n=Js.parseRgba(i.color)||Wo;return e.utils.colors.shade(n,s)},ml=(e,t)=>(s,i)=>{const n=s.series[i];return n._focus===!1?n.getFocusedColor(e,i):n[t]},jo=(e,t,s=!0)=>{const i=t>=0;let n=-1/0,r=null,o=1/0,u=null;const c=[];let f=null;for(let p=e.rows.length-1;p>=0;p--){const m=e.rows[p],{displayY:h,rowIdx:b}=m;let _;h!==null&&(h>n&&(n=h,r=m.rowIdx),h<o&&(o=h,u=m.rowIdx)),h===null||(i?h<0:h>=0)?_=null:i?_=t>h?null:h-t:_=t<h?null:Math.abs(h-t);const y=f===null?1/0:c[f],A=_===null?y:Math.min(y,_);(_!==null&&y===_||A!==y)&&(f=b)}return f===null&&s?t>=n?r:t<=o?u:null:f},Xo=(e,t,s)=>{let i=0,n=0;for(;n<e.length;){const r=e.length-n-1,o=e[r],u=o.$c;if(n+=1,o.scale!==s||o.show===!1)continue;const c=u[t];i+=typeof c=="number"?c:0}return i},Ko=(e,t)=>{let s,i,n=0;for(;!i&&n<e.rows.length;){const r=e.rows[n].displayY;r!==null&&(s=n,i=Math.abs(r-(t||0))),n+=1}if(!i||s===void 0)return null;for(n=s+1;n<e.rows.length;n++){const r=e.rows[n].displayY;if(r===null)continue;const o=Math.abs(r-t);i>o&&(i=o,s=n)}return s},qo=e=>e>=1e18?[1e18,"E"]:e>=1e15?[1e15,"P"]:e>=1e12?[1e12,"T"]:e>=1e9?[1e9,"G"]:e>=1e6?[1e6,"M"]:e>=1e3?[1e3,"K"]:[1,""];function Zo(e,t){if(t===0)return parseInt(e);if(Number.isInteger(e))return e+"."+"0".repeat(t);const[s,i]=e.toString().split(".");return i.length>=t?`${s}.${i.slice(0,t)}`:`${s}.${i}${"0".repeat(t-i.length)}`}function Qs(e,t,s,i="closest",n=null){let r=s,o=s;const u=t.snapToValues??i;if(u===!1)return s;if(u==="left"||u==="closest"){for(let c=s-1;c>=0;c--)if(e[c]!==n){r=c;break}}if(u==="right"||u==="closest"){for(let c=s+1;c<e.length;c++)if(e[c]!==n){o=c;break}}return u==="left"?r:u==="right"?o:o-s>s-r?r:o}var vl=(e,t,s,i,n,r,o,u="linear")=>{let c=null;const f=e[r];switch(u){case"linear":{if(t===null||s===null)return null;c=t+(f-i)*(s-t)/(n-i),(isNaN(c)||Math.abs(c)===1/0)&&(c=null);break}case"previous":{c=t;break}case"next":{c=s;break}case"left":{c=o[o.length-1]===e.length-1||s===null?null:t;break}case"right":{c=o[0]===0?null:s;break}case"closest":{const p=Math.abs(i-e[r]),m=Math.abs(n-e[r]);c=p<m?t:s;break}default:c=u}return c},_l=()=>Math.random().toString(36).substr(2,9).replace(/^\d+/,""),Jo=(e,t,s)=>{const i=[],n=s.nullValues||{},r=s.interpolation;for(let o=0;o<e.length;o++){const u=e[o],c=[];let f=[],p=null,m=null,h,b;for(let _=0;_<u.length;_++){let y=u[_];if(r&&y===r.value){f.push(_);continue}if(n[y]&&(y=null),f.length){m=y,b=t[_];for(const A of f)c[A]=vl(t,p,m,h||t[0],b||t[t.length-1],A,f,r&&r.type);f=[]}p=y,h=t[_],c.push(y)}if(m=null,f.length)for(const _ of f)c.push(vl(t,p,m,h||t[0],b||t[t.length-1],_,f,r&&r.type));i.push(c)}return i};function Qo(e,t=300){let s;return(...i)=>{clearTimeout(s),s=setTimeout(()=>e(...i),t)}}var kt=e=>e+"px",Vt=(e,t={},s)=>{const i=document.createElement(e);return Object.keys(t).forEach(n=>{const r=t[n];i.setAttribute(n,typeof r=="object"?Object.entries(r).map(([o,u])=>`${o}:${u}`).join(";"):r)}),s&&(typeof s=="string"?i.innerHTML=s:i.appendChild(s)),i};function Sl(e,t){return t.split(".").reduce((s,i)=>Object.getOwnPropertyDescriptor(s,i)?.value??{},e)}function Ls(e,t){if(typeof e!=typeof t)return!1;if((typeof e=="function"||typeof t=="function")&&(e=e.toString(),t=t.toString()),typeof e!="object"||Ht(e)||Ht(t))return e===t;const s=e,i=t,n=Object.keys(s),r=Object.keys(i);if(n.length!==r.length)return!1;for(const o of n)if(!i.hasOwnProperty(o)||!Ls(s[o],i[o]))return!1;return!0}function yl(e){return typeof e=="function"||typeof e>"u"?e:()=>e}function Ht(e){return e==null}function wl(e,t,s){return e>=t&&e<=s?e:e<t?t:s}var ea=50;function bl(e,t,s){if(s||=t.querySelector("span"),!s)return;t.style.background=`${e.color}`,s.style.background=e.color||ol;const i=Js.parseRgba(e.color)||[256,256,256,0];t.style.boxShadow=`0px 0px 0px 1px rgba(${i[0]}, ${i[1]}, ${i[2]}, 0.5)`}function ta(e,t){const s=e.series[t],i=Vt("span"),n=Vt("div",{class:"yagr-point","data-idx":String(t)},s.empty?void 0:i);return s.empty?(n.style.display="none",n):(bl(s,n,i),n)}function El(e,t){return t===void 0?Array.from(e.querySelectorAll(".yagr-point")):[e.querySelector(`.yagr-point[data-idx="${t}"]`)]}function sa(e,t){const i=e.config.processing||{},n=!!i.interpolation,r=i.interpolation?.value,o=t.snapToValues===!1?!1:t.snapToValues||"closest",u=n?i.interpolation?.snapToValues??"closest":!1;let c={};const f=(p,m,h)=>{const b=p.series[m];if(b.scale===Te)return h;const _=b.$c||p.data[m],y=_[h];return n&&y===r?Qs(_,b,h,u,r):y===null?Qs(_,b,h,o,null):h};return{showPoints:p=>{const m=e.uplot.over;if(!m)return;El(m,p).forEach(b=>{b.style.visibility="visible"})},hidePoints:p=>{const m=e.uplot.over;if(!m)return;El(m,p).forEach(b=>{b.style.visibility="hidden"})},pin:p=>{const m=e.root.querySelector(".u-over");if(m)if(p){const h=document.createElement("div");h.classList.add("yagr-points-holder"),m.querySelectorAll(".yagr-point").forEach(b=>{const _=b.cloneNode(!0);h.appendChild(_);const y=_.dataset.idx;y&&(c[y]=_)}),m.appendChild(h)}else c={},m.querySelector(".yagr-points-holder")?.remove()},updatePoints:()=>{e.root.querySelectorAll(".yagr-point").forEach(p=>{const m=Number(p.dataset.idx);if(isNaN(m))return;const h=e.uplot.series[m];bl(h,p)})},focus:(p,m)=>{Object.entries(c).forEach(([h,b])=>{if(p===null){b.style.display=m?"block":"none";return}b.style.display=h===String(p)&&m?"block":"none"})},uplot:{opts:(p,m)=>{m.cursor=m.cursor||{};const h=m.series.filter(y=>y.empty).length,b=m.series.length-1,_=t?.maxMarkers??ea;m.cursor.points={show:b-h<=_?ta:!1,size:(y,A)=>{const I=y.series[A];return(I.cursorOptions?I.cursorOptions.markersSize:t?.markersSize)||ul}},m.cursor.dataIdx=f},hooks:{...t.hideMarkers&&{setCursor:p=>{const m=p.cursor.idx;if(!Ht(m))for(let h=1;h<p.series.length;h++){const b=p.series[h].$c[m];t.hideMarkers(b,h)?e.plugins.cursor?.hidePoints(h):e.plugins.cursor?.showPoints(h)}}},init:p=>{const m=p.root.querySelector(".u-cursor-x");m&&(t.x&&t.x.visible===!1&&(m.style.display="none"),m.style.borderRight=t.x&&t.x.style||Ni);const h=p.root.querySelector(".u-cursor-y");h&&(t.y&&t.y.visible!==!1?h.style.borderBottom=t.y.style||Ni:h.style.display="none")}}}}}var Tl=e=>e.preventDefault(),Is="null",ia=18,na=20,la=48,ra=12,oa=.3,zi=e=>e.some(({show:t,id:s})=>s!==Oi&&t),Al=(e,t)=>t.length>3&&e(zi(t)?"hide-all":"show-all"),aa=e=>e.length>3&&Is||void 0,Ll=class{constructor(){this.pagesCount=0,this.state={page:0,pages:1,pageSize:0,rowsPerPage:1,paginated:!1,requiredSpace:0,totalSpace:0},this.itemsHtml="",this.preInit=(e,t,s)=>{this.yagr=e,this.options=Object.assign({show:!1,position:"bottom",fontSize:ra,maxLegendSpace:oa,className:void 0,behaviour:"basic"},t||{}),this.calc(s)},this.init=e=>{this.options.show&&(this.uplot=e,e.root.querySelector(".u-legend")?.remove(),this.render())},this.update=()=>{this.yagr.root.querySelectorAll("[data-serie-id]").forEach(t=>{const s=t.getAttribute("data-serie-id");if(!s||s===Is)return;const i=this.uplot?.series[this.yagr.state.y2uIdx[s]]?.show;t.classList[i?"remove":"add"]("yagr-legend__item_hidden")})},this.measureLegend=e=>{const t=this.yagr.root,s=Vt("div",{class:"yagr-legend",style:{visibility:"hidden"}},e);t.appendChild(s);const n=s.childNodes[0].getBoundingClientRect();return s.remove(),n},this.nextPage=()=>{const{state:e}=this;this.state.page+=1,this.items&&(this.items.style.transform=`translate(0, ${-1*e.page*e.pageSize}px)`,this.renderPagination())},this.prevPage=()=>{const{state:e}=this;this.state.page-=1,this.items&&(this.items.style.transform=`translate(0, ${-1*e.page*e.pageSize}px)`,this.renderPagination())}}redraw(){this.options.show&&this.render()}destroy(){this._onDestroy&&this._onDestroy(),this.legendEl?.remove()}applyHandlers(){const{yagr:e,uplot:t}=this;if(!t)return()=>{};const s=e.root.querySelectorAll("[data-serie-id]"),i=[],o={basic:p=>()=>{const m=p.getAttribute("data-serie-id"),h=[];if(m===Is){const _=!zi(t.series);for(let y=1;y<t.series.length;y++)h.push([t.series[y],_])}else{const _=t.series.find(({id:y})=>y===m);if(!_)return;h.push([_,!_.show])}h.forEach(([_,y])=>{if(_.show===y)return;const A=e.root.querySelector(`[data-serie-id="${_.id}"]`);e.setVisible(_.id,y,!1),A?.classList[y?"remove":"add"]("yagr-legend__item_hidden")});const b=e.root.querySelector(".yagr-legend__all-series");if(b){const _=Al(this.yagr.utils.i18n,t.series);b.innerHTML=_||""}},extended:p=>{const m=(y,A)=>{const I=e.root.querySelector(`[data-serie-id="${y}"]`);e.setVisible(y,A,!1),I?.classList[A?"remove":"add"]("yagr-legend__item_hidden")},h=y=>{m(y.id,!y.show)},b=y=>{this.state.startSerieRange=y;const A=t.series.filter(O=>O.id!==y.id),I=!zi(A)&&y.show!==!1;t.series.forEach(O=>{const w=y.id===O.id?!0:I;m(O.id,w)})},_=y=>{this.state.startSerieRange||(this.state.startSerieRange=t.series[1]);const A=[];t.series.forEach((I,O)=>{I.id===y.id&&A.push(O),I.id===this.state.startSerieRange?.id&&A.push(O)}),t.series.forEach((I,O)=>{const w=O>=A[0]&&O<=A[1];m(I.id,w)})};return y=>{const A=p.getAttribute("data-serie-id"),I=t.series.find(({id:O})=>O===A);I&&(y.preventDefault(),y.ctrlKey||y.metaKey?h(I):y.shiftKey?_(I):b(I))}}},u=p=>()=>{const m=p.getAttribute("data-serie-id");if(p.classList.contains("yagr-legend__item_hidden")||m===Is)return;const h=this.yagr.uplot.series.find(({id:b})=>b===m);h&&e.setFocus(h.id,!0)},c=()=>{e.setFocus(null,!0)};s.forEach(p=>{const m=o[this.options.behaviour||"basic"](p),h=u(p);p.addEventListener("click",m),p.addEventListener("mouseenter",h),p.addEventListener("mouseleave",c),p.addEventListener("mousedown",Tl),i.push(()=>{p.removeEventListener("click",m),p.removeEventListener("mouseenter",h),p.removeEventListener("mouseleave",c),p.removeEventListener("mousedown",Tl)})});const f=()=>i.forEach(p=>p());return this._onDestroy=f,f}render(){let e=!1;const{uplot:t,options:s}=this;if(!t)return;let i=this.yagr.root.querySelector(".yagr-legend");if(i?e=!0:i=Vt("div",{class:`yagr-legend yagr-legend__${this.options.position} ${s?.className||""}`}),!!i){if(e||(s.position==="top"?t.root.before(i):t.root?.after(i)),this.legendEl=i,(!this.itemsHtml||e)&&this.calc(this.yagr.options),i.innerHTML=`<div class="yagr-legend__container" style="height: ${this.state.requiredSpace}px">${this.itemsHtml}</div>`,this.items=i.querySelector(".yagr-legend__items"),this.container=i.querySelector(".yagr-legend__container"),this.state.paginated){const n=this.renderPagination();this.container?.after(n)}else this.items.style.justifyContent="center";this.applyHandlers()}}renderPagination(){const{state:e}=this;let t=this.yagr.root.querySelector(".yagr-legend__pagination");if(t){const o=t.querySelector(".yagr-legend__icon-down"),u=t.querySelector(".yagr-legend__icon-up");o.removeEventListener("click",this.nextPage),u.removeEventListener("click",this.prevPage)}else t=Vt("div",{class:"yagr-legend__pagination"});const s=e.page===0?"yagr-legend__icon-up_disabled":"",i=e.page===e.pages-1?"yagr-legend__icon-down_disabled":"";t.innerHTML=`<span class="yagr-legend__icon-up ${s}"></span>
<span class="yagr-legend__pagination-text">${e.page+1}/${e.pages}</span>
<span class="yagr-legend__icon-down ${i}"></span>`;const n=t.querySelector(".yagr-legend__icon-down"),r=t.querySelector(".yagr-legend__icon-up");return i||n.addEventListener("click",this.nextPage),s||r.addEventListener("click",this.prevPage),t}createIconLineElement(e){return Vt("span",{class:`yagr-legend__icon yagr-legend__icon_${e.type}`,style:{"background-color":e.color}})}createSerieNameElement(e){const t=Vt("span");return t.innerText=e.name||"unnamed",t}renderItems(e){const t=Al(this.yagr.utils.i18n,e.series),s=this.options.behaviour!=="extended"&&aa(e.series),i=s?[s]:[];for(let r=1;r<e.series.length;r++)i.push(e.series[r]);return`<div class="yagr-legend__items">${i.map(r=>{let o,u,c=" ";if(r===Is)o=t,u=s,c=" yagr-legend__all-series ";else{u=r.id;const p=this.createIconLineElement(r),m=this.createSerieNameElement(r);o=`${p.outerHTML}${m.outerHTML}`}const f=typeof r=="string"?!0:r.show!==!1;return`<div class="yagr-legend__item${c}${f?"":"yagr-legend__item_hidden"}" data-serie-id="${u}">${o}</div>`}).join("")}</div>`}calc(e){if(!this.options.show)return;const t=e.height-this.VERTICAL_PADDING,s=this.renderItems(e),{height:i}=this.measureLegend(s),n=this.options.fontSize+2,r=t*this.options.maxLegendSpace,o=Math.floor(r/n),u=o-1,c=Math.min(u*n,r),f=Math.min(o*n,r),p=i>c&&c>0,m=Math.min(p?f:c,i),h=Math.ceil(i/c),b=p?this.VERTICAL_PADDING+ia:this.VERTICAL_PADDING;this.state.requiredSpace=m,this.state.totalSpace=m+b,this.state.paginated=p,this.state.page=this.state.page||0,this.state.pages=h,this.state.pageSize=c,this.state.rowsPerPage=o,this.itemsHtml=s}get VERTICAL_PADDING(){return this.options.position==="bottom"?na:la}},ca=!0,Ae="u-",ua="uplot",fa=Ae+"hz",ha=Ae+"vt",pa=Ae+"title",da=Ae+"wrap",ga=Ae+"under",ma=Ae+"over",va=Ae+"axis",Ut=Ae+"off",_a=Ae+"select",Sa=Ae+"cursor-x",ya=Ae+"cursor-y",wa=Ae+"cursor-pt",ba=Ae+"legend",Ea=Ae+"live",Ta=Ae+"inline",Aa=Ae+"series",La=Ae+"marker",Il=Ae+"label",Ia=Ae+"value",ks="width",xs="height",Ds="top",kl="bottom",ts="left",Vi="right",Hi="#000",xl=Hi+"0",Dl="mousemove",Ol="mousedown",Ui="mouseup",Ml="mouseenter",Rl="mouseleave",Pl="dblclick",ka="resize",xa="scroll",Fl="change",ei="dppxchange",Bi="--",ss=typeof window<"u",Gi=ss?document:null,is=ss?window:null,Da=ss?navigator:null,ne,ti;function $i(){let e=devicePixelRatio;ne!=e&&(ne=e,ti&&ji(Fl,ti,$i),ti=matchMedia(`(min-resolution: ${ne-.001}dppx) and (max-resolution: ${ne+.001}dppx)`),Bt(Fl,ti,$i),is.dispatchEvent(new CustomEvent(ei)))}function qe(e,t){if(t!=null){let s=e.classList;!s.contains(t)&&s.add(t)}}function Wi(e,t){let s=e.classList;s.contains(t)&&s.remove(t)}function ve(e,t,s){e.style[t]=s+"px"}function nt(e,t,s,i){let n=Gi.createElement(e);return t!=null&&qe(n,t),s?.insertBefore(n,i),n}function et(e,t){return nt("div",e,t)}var Cl=new WeakMap;function ns(e,t,s,i,n){let r="translate("+t+"px,"+s+"px)",o=Cl.get(e);r!=o&&(e.style.transform=r,Cl.set(e,r),t<0||s<0||t>i||s>n?qe(e,Ut):Wi(e,Ut))}var Nl=new WeakMap;function Oa(e,t,s){let i=t+s,n=Nl.get(e);i!=n&&(Nl.set(e,i),e.style.background=t,e.style.borderColor=s)}var zl=new WeakMap;function Ma(e,t,s,i){let n=t+""+s,r=zl.get(e);n!=r&&(zl.set(e,n),e.style.height=s+"px",e.style.width=t+"px",e.style.marginLeft=i?-t/2+"px":0,e.style.marginTop=i?-s/2+"px":0)}var Yi={passive:!0},Vl={...Yi,capture:!0};function Bt(e,t,s,i){t.addEventListener(e,s,i?Vl:Yi)}function ji(e,t,s,i){t.removeEventListener(e,s,i?Vl:Yi)}ss&&$i();function xt(e,t,s,i){let n;s=s||0,i=i||t.length-1;let r=i<=2147483647;for(;i-s>1;)n=r?s+i>>1:Je((s+i)/2),t[n]<e?s=n:i=n;return e-t[s]<=t[i]-e?s:i}function ls(e,t,s,i){for(let n=i==1?t:s;n>=t&&n<=s;n+=i)if(e[n]!=null)return n;return-1}function Ra(e,t,s,i){let n=q,r=-q;if(i==1)n=e[t],r=e[s];else if(i==-1)n=e[s],r=e[t];else for(let o=t;o<=s;o++){let u=e[o];u!=null&&(u<n&&(n=u),u>r&&(r=u))}return[n,r]}function Pa(e,t,s){let i=q,n=-q;for(let r=t;r<=s;r++){let o=e[r];o!=null&&o>0&&(o<i&&(i=o),o>n&&(n=o))}return[i==q?1:i,n==-q?10:n]}function si(e,t,s,i){let n=Bl(e),r=Bl(t),o=s==10?wt:Gl;e==t&&(n==-1?(e*=s,t/=s):(e/=s,t*=s));let u=n==1?Je:rs,c=r==1?rs:Je,f=u(o(Ie(e))),p=c(o(Ie(t))),m=os(s,f),h=os(s,p);return s==10&&(f<0&&(m=fe(m,-f)),p<0&&(h=fe(h,-p))),i||s==2?(e=m*n,t=h*r):(e=Kl(e,m),t=cs(t,h)),[e,t]}function Xi(e,t,s,i){let n=si(e,t,s,i);return e==0&&(n[0]=0),t==0&&(n[1]=0),n}var Ki=.1,Hl={mode:3,pad:Ki},Os={pad:0,soft:null,mode:0},Fa={min:Os,max:Os};function ii(e,t,s,i){return ri(s)?Ul(e,t,s):(Os.pad=s,Os.soft=i?0:null,Os.mode=i?3:0,Ul(e,t,Fa))}function le(e,t){return e??t}function Ca(e,t,s){for(t=le(t,0),s=le(s,e.length-1);t<=s;){if(e[t]!=null)return!0;t++}return!1}function Ul(e,t,s){let i=s.min,n=s.max,r=le(i.pad,0),o=le(n.pad,0),u=le(i.hard,-q),c=le(n.hard,q),f=le(i.soft,q),p=le(n.soft,-q),m=le(i.mode,0),h=le(n.mode,0),b=t-e,_=wt(b),y=Fe(Ie(e),Ie(t)),A=wt(y),I=Ie(A-_);(b<1e-9||I>10)&&(b=0,(e==0||t==0)&&(b=1e-9,m==2&&f!=q&&(r=0),h==2&&p!=-q&&(o=0)));let O=b||y||1e3,w=wt(O),x=os(10,Je(w)),E=O*(b==0?e==0?.1:1:r),F=fe(Kl(e-E,x/10),9),R=e>=f&&(m==1||m==3&&F<=f||m==2&&F>=f)?f:q,U=Fe(u,F<R&&e>=R?R:tt(R,F)),N=O*(b==0?t==0?.1:1:o),P=fe(cs(t+N,x/10),9),L=t<=p&&(h==1||h==3&&P>=p||h==2&&P<=p)?p:-q,H=tt(c,P>L&&t<=L?L:Fe(L,P));return U==H&&U==0&&(H=100),[U,H]}var Na=new Intl.NumberFormat(ss?Da.language:"en-US"),qi=e=>Na.format(e),Ze=Math,ni=Ze.PI,Ie=Ze.abs,Je=Ze.floor,Pe=Ze.round,rs=Ze.ceil,tt=Ze.min,Fe=Ze.max,os=Ze.pow,Bl=Ze.sign,wt=Ze.log10,Gl=Ze.log2,za=(e,t=1)=>Ze.sinh(e)*t,Zi=(e,t=1)=>Ze.asinh(e/t),q=1/0;function $l(e){return(wt((e^e>>31)-(e>>31))|0)+1}function li(e,t,s){return tt(Fe(e,t),s)}function Z(e){return typeof e=="function"?e:()=>e}var Va=()=>{},Wl=e=>e,Yl=(e,t)=>t,Ha=e=>null,jl=e=>!0,Xl=(e,t)=>e==t,as=e=>fe(e,14);function Gt(e,t){return as(fe(as(e/t))*t)}function cs(e,t){return as(rs(as(e/t))*t)}function Kl(e,t){return as(Je(as(e/t))*t)}function fe(e,t=0){if(Ua(e))return e;let s=10**t,i=e*s*(1+Number.EPSILON);return Pe(i)/s}var us=new Map;function ql(e){return((""+e).split(".")[1]||"").length}function Ms(e,t,s,i){let n=[],r=i.map(ql);for(let o=t;o<s;o++){let u=Ie(o),c=fe(os(e,o),u);for(let f=0;f<i.length;f++){let p=i[f]*c,m=(p>=0&&o>=0?0:u)+(o>=r[f]?0:r[f]),h=fe(p,m);n.push(h),us.set(h,m)}}return n}var Rs={},Zl=[],fs=[null,null],Dt=Array.isArray,Ua=Number.isInteger,Ba=e=>e===void 0;function Jl(e){return typeof e=="string"}function ri(e){let t=!1;if(e!=null){let s=e.constructor;t=s==null||s==Object}return t}function Ql(e){return e!=null&&typeof e=="object"}var Ga=Object.getPrototypeOf(Uint8Array);function $t(e,t=ri){let s;if(Dt(e)){let i=e.find(n=>n!=null);if(Dt(i)||t(i)){s=Array(e.length);for(let n=0;n<e.length;n++)s[n]=$t(e[n],t)}else s=e.slice()}else if(e instanceof Ga)s=e.slice();else if(t(e)){s={};for(let i in e)s[i]=$t(e[i],t)}else s=e;return s}function we(e){let t=arguments;for(let s=1;s<t.length;s++){let i=t[s];for(let n in i)ri(e[n])?we(e[n],$t(i[n])):e[n]=$t(i[n])}return e}var $a=0,Wa=1,Ya=2;function ja(e,t,s){for(let i=0,n,r=-1;i<t.length;i++){let o=t[i];if(o>r){for(n=o-1;n>=0&&e[n]==null;)e[n--]=null;for(n=o+1;n<s&&e[n]==null;)e[r=n++]=null}}}function Xa(e,t){if(Za(e)){let o=e[0].slice();for(let u=1;u<e.length;u++)o.push(...e[u].slice(1));return Ja(o[0])||(o=qa(o)),o}let s=new Set;for(let o=0;o<e.length;o++){let c=e[o][0],f=c.length;for(let p=0;p<f;p++)s.add(c[p])}let i=[Array.from(s).sort((o,u)=>o-u)],n=i[0].length,r=new Map;for(let o=0;o<n;o++)r.set(i[0][o],o);for(let o=0;o<e.length;o++){let u=e[o],c=u[0];for(let f=1;f<u.length;f++){let p=u[f],m=Array(n).fill(void 0),h=t?t[o][f]:Wa,b=[];for(let _=0;_<p.length;_++){let y=p[_],A=r.get(c[_]);y===null?h!=$a&&(m[A]=y,h==Ya&&b.push(A)):m[A]=y}ja(m,b,n),i.push(m)}}return i}var Ka=typeof queueMicrotask>"u"?e=>Promise.resolve().then(e):queueMicrotask;function qa(e){let t=e[0],s=t.length,i=Array(s);for(let r=0;r<i.length;r++)i[r]=r;i.sort((r,o)=>t[r]-t[o]);let n=[];for(let r=0;r<e.length;r++){let o=e[r],u=Array(s);for(let c=0;c<s;c++)u[c]=o[i[c]];n.push(u)}return n}function Za(e){let t=e[0][0],s=t.length;for(let i=1;i<e.length;i++){let n=e[i][0];if(n.length!=s)return!1;if(n!=t){for(let r=0;r<s;r++)if(n[r]!=t[r])return!1}}return!0}function Ja(e,t=100){const s=e.length;if(s<=1)return!0;let i=0,n=s-1;for(;i<=n&&e[i]==null;)i++;for(;n>=i&&e[n]==null;)n--;if(n<=i)return!0;const r=Fe(1,Je((n-i+1)/t));for(let o=e[i],u=i+r;u<=n;u+=r){const c=e[u];if(c!=null){if(c<=o)return!1;o=c}}return!0}var er=["January","February","March","April","May","June","July","August","September","October","November","December"],tr=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function sr(e){return e.slice(0,3)}var Qa=tr.map(sr),ec=er.map(sr),tc={MMMM:er,MMM:ec,WWWW:tr,WWW:Qa};function Ps(e){return(e<10?"0":"")+e}function sc(e){return(e<10?"00":e<100?"0":"")+e}var ic={YYYY:e=>e.getFullYear(),YY:e=>(e.getFullYear()+"").slice(2),MMMM:(e,t)=>t.MMMM[e.getMonth()],MMM:(e,t)=>t.MMM[e.getMonth()],MM:e=>Ps(e.getMonth()+1),M:e=>e.getMonth()+1,DD:e=>Ps(e.getDate()),D:e=>e.getDate(),WWWW:(e,t)=>t.WWWW[e.getDay()],WWW:(e,t)=>t.WWW[e.getDay()],HH:e=>Ps(e.getHours()),H:e=>e.getHours(),h:e=>{let t=e.getHours();return t==0?12:t>12?t-12:t},AA:e=>e.getHours()>=12?"PM":"AM",aa:e=>e.getHours()>=12?"pm":"am",a:e=>e.getHours()>=12?"p":"a",mm:e=>Ps(e.getMinutes()),m:e=>e.getMinutes(),ss:e=>Ps(e.getSeconds()),s:e=>e.getSeconds(),fff:e=>sc(e.getMilliseconds())};function Ji(e,t){t=t||tc;let s=[],i=/\{([a-z]+)\}|[^{]+/gi,n;for(;n=i.exec(e);)s.push(n[0][0]=="{"?ic[n[1]]:n[0]);return r=>{let o="";for(let u=0;u<s.length;u++)o+=typeof s[u]=="string"?s[u]:s[u](r,t);return o}}var nc=new Intl.DateTimeFormat().resolvedOptions().timeZone;function lc(e,t){let s;return t=="UTC"||t=="Etc/UTC"?s=new Date(+e+e.getTimezoneOffset()*6e4):t==nc?s=e:(s=new Date(e.toLocaleString("en-US",{timeZone:t})),s.setMilliseconds(e.getMilliseconds())),s}var ir=e=>e%1==0,oi=[1,2,2.5,5],rc=Ms(10,-16,0,oi),nr=Ms(10,0,16,oi),oc=nr.filter(ir),ac=rc.concat(nr),Qi=`
`,lr="{YYYY}",rr=Qi+lr,or="{M}/{D}",Fs=Qi+or,ai=Fs+"/{YY}",ar="{aa}",cc="{h}:{mm}",hs=cc+ar,cr=Qi+hs,ur=":{ss}",oe=null;function fr(e){let t=e*1e3,s=t*60,i=s*60,n=i*24,r=n*30,o=n*365,c=(e==1?Ms(10,0,3,oi).filter(ir):Ms(10,-3,0,oi)).concat([t,t*5,t*10,t*15,t*30,s,s*5,s*10,s*15,s*30,i,i*2,i*3,i*4,i*6,i*8,i*12,n,n*2,n*3,n*4,n*5,n*6,n*7,n*8,n*9,n*10,n*15,r,r*2,r*3,r*4,r*6,o,o*2,o*5,o*10,o*25,o*50,o*100]);const f=[[o,lr,oe,oe,oe,oe,oe,oe,1],[n*28,"{MMM}",rr,oe,oe,oe,oe,oe,1],[n,or,rr,oe,oe,oe,oe,oe,1],[i,"{h}"+ar,ai,oe,Fs,oe,oe,oe,1],[s,hs,ai,oe,Fs,oe,oe,oe,1],[t,ur,ai+" "+hs,oe,Fs+" "+hs,oe,cr,oe,1],[e,ur+".{fff}",ai+" "+hs,oe,Fs+" "+hs,oe,cr,oe,1]];function p(m){return(h,b,_,y,A,I)=>{let O=[],w=A>=o,x=A>=r&&A<o,E=m(_),F=fe(E*e,3),R=en(E.getFullYear(),w?0:E.getMonth(),x||w?1:E.getDate()),U=fe(R*e,3);if(x||w){let N=x?A/r:0,P=w?A/o:0,L=F==U?F:fe(en(R.getFullYear()+P,R.getMonth()+N,1)*e,3),H=new Date(Pe(L/e)),X=H.getFullYear(),K=H.getMonth();for(let Y=0;L<=y;Y++){let ae=en(X+P*Y,K+N*Y,1),W=ae-m(fe(ae*e,3));L=fe((+ae+W)*e,3),L<=y&&O.push(L)}}else{let N=A>=n?n:A,P=Je(_)-Je(F),L=U+P+cs(F-U,N);O.push(L);let H=m(L),X=H.getHours()+H.getMinutes()/s+H.getSeconds()/i,K=A/i,Y=h.axes[b]._space,ae=I/Y;for(;L=fe(L+A,e==1?0:3),!(L>y);)if(K>1){let W=Je(fe(X+K,6))%24,Q=m(L).getHours()-W;Q>1&&(Q=-1),L-=Q*i,X=(X+K)%24;let ce=O[O.length-1];fe((L-ce)/A,3)*ae>=.7&&O.push(L)}else O.push(L)}return O}}return[c,f,p]}var[uc,fc,hc]=fr(1),[pc,dc,gc]=fr(.001);Ms(2,-53,53,[1]);function hr(e,t){return e.map(s=>s.map((i,n)=>n==0||n==8||i==null?i:t(n==1||s[8]==0?i:s[1]+i)))}function pr(e,t){return(s,i,n,r,o)=>{let u=t.find(_=>o>=_[0])||t[t.length-1],c,f,p,m,h,b;return i.map(_=>{let y=e(_),A=y.getFullYear(),I=y.getMonth(),O=y.getDate(),w=y.getHours(),x=y.getMinutes(),E=y.getSeconds(),F=A!=c&&u[2]||I!=f&&u[3]||O!=p&&u[4]||w!=m&&u[5]||x!=h&&u[6]||E!=b&&u[7]||u[1];return c=A,f=I,p=O,m=w,h=x,b=E,F(y)})}}function mc(e,t){let s=Ji(t);return(i,n,r,o,u)=>n.map(c=>s(e(c)))}function en(e,t,s){return new Date(e,t,s)}function dr(e,t){return t(e)}var vc="{YYYY}-{MM}-{DD} {h}:{mm}{aa}";function gr(e,t){return(s,i,n,r)=>r==null?Bi:t(e(i))}function _c(e,t){let s=e.series[t];return s.width?s.stroke(e,t):s.points.width?s.points.stroke(e,t):null}function Sc(e,t){return e.series[t].fill(e,t)}var yc={show:!0,live:!0,isolate:!1,mount:Va,markers:{show:!0,width:2,stroke:_c,fill:Sc,dash:"solid"},idx:null,idxs:null,values:[]};function wc(e,t){let s=e.cursor.points,i=et(),n=s.size(e,t);ve(i,ks,n),ve(i,xs,n);let r=n/-2;ve(i,"marginLeft",r),ve(i,"marginTop",r);let o=s.width(e,t,n);return o&&ve(i,"borderWidth",o),i}function bc(e,t){let s=e.series[t].points;return s._fill||s._stroke}function Ec(e,t){let s=e.series[t].points;return s._stroke||s._fill}function Tc(e,t){return e.series[t].points.size}function Ac(e,t,s){return s}var tn=[0,0];function Lc(e,t,s){return tn[0]=t,tn[1]=s,tn}function ci(e,t,s,i=!0){return n=>{n.button==0&&(!i||n.target==t)&&s(n)}}function sn(e,t,s,i=!0){return n=>{(!i||n.target==t)&&s(n)}}var Ic={show:!0,x:!0,y:!0,lock:!1,move:Lc,points:{show:wc,size:Tc,width:0,stroke:Ec,fill:bc},bind:{mousedown:ci,mouseup:ci,click:ci,dblclick:ci,mousemove:sn,mouseleave:sn,mouseenter:sn},drag:{setScale:!0,x:!0,y:!1,dist:0,uni:null,click:(e,t)=>{t.stopPropagation(),t.stopImmediatePropagation()},_x:!1,_y:!1},focus:{prox:-1,bias:0},left:-10,top:-10,idx:null,dataIdx:Ac,idxs:null,event:null},mr={show:!0,stroke:"rgba(0,0,0,0.07)",width:2},nn=we({},mr,{filter:Yl}),vr=we({},nn,{size:10}),_r=we({},mr,{show:!1}),ln='12px system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"',Sr="bold "+ln,yr=1.5,wr={show:!0,scale:"x",stroke:Hi,space:50,gap:5,size:50,labelGap:0,labelSize:30,labelFont:Sr,side:2,grid:nn,ticks:vr,border:_r,font:ln,lineGap:yr,rotate:0},kc="Value",xc="Time",br={show:!0,scale:"x",auto:!1,sorted:1,min:q,max:-q,idxs:[]};function Dc(e,t,s,i,n){return t.map(r=>r==null?"":qi(r))}function Oc(e,t,s,i,n,r,o){let u=[],c=us.get(n)||0;s=o?s:fe(cs(s,n),c);for(let f=s;f<=i;f=fe(f+n,c))u.push(Object.is(f,-0)?0:f);return u}function rn(e,t,s,i,n,r,o){const u=[],c=e.scales[e.axes[t].scale].log,f=c==10?wt:Gl,p=Je(f(s));n=os(c,p),c==10&&p<0&&(n=fe(n,-p));let m=s;do u.push(m),m=m+n,c==10&&(m=fe(m,us.get(n))),m>=n*c&&(n=m);while(m<=i);return u}function Mc(e,t,s,i,n,r,o){let c=e.scales[e.axes[t].scale].asinh,f=i>c?rn(e,t,Fe(c,s),i,n):[c],p=i>=0&&s<=0?[0]:[];return(s<-c?rn(e,t,Fe(c,-i),-s,n):[c]).reverse().map(h=>-h).concat(p,f)}var Er=/./,Rc=/[12357]/,Pc=/[125]/,Tr=/1/,on=(e,t,s,i)=>e.map((n,r)=>t==4&&n==0||r%i==0&&s.test(n.toExponential()[n<0?1:0])?n:null);function Fc(e,t,s,i,n){let r=e.axes[s],o=r.scale,u=e.scales[o],c=e.valToPos,f=r._space,p=c(10,o),m=c(9,o)-p>=f?Er:c(7,o)-p>=f?Rc:c(5,o)-p>=f?Pc:Tr;if(m==Tr){let h=Ie(c(1,o)-p);if(h<f)return on(t.slice().reverse(),u.distr,m,rs(f/h)).reverse()}return on(t,u.distr,m,1)}function Cc(e,t,s,i,n){let r=e.axes[s],o=r.scale,u=r._space,c=e.valToPos,f=Ie(c(1,o)-c(2,o));return f<u?on(t.slice().reverse(),3,Er,rs(u/f)).reverse():t}function Nc(e,t,s,i){return i==null?Bi:t==null?"":qi(t)}var Ar={show:!0,scale:"y",stroke:Hi,space:30,gap:5,size:50,labelGap:0,labelSize:30,labelFont:Sr,side:3,grid:nn,ticks:vr,border:_r,font:ln,lineGap:yr,rotate:0};function zc(e,t){let s=3+(e||1)*2;return fe(s*t,3)}function Vc(e,t){let{scale:s,idxs:i}=e.series[0],n=e._data[0],r=e.valToPos(n[i[0]],s,!0),o=e.valToPos(n[i[1]],s,!0),u=Ie(o-r),c=e.series[t],f=u/(c.points.space*ne);return i[1]-i[0]<=f}var Lr={scale:null,auto:!0,sorted:0,min:q,max:-q},Ir=(e,t,s,i,n)=>n,kr={show:!0,auto:!0,sorted:0,gaps:Ir,alpha:1,facets:[we({},Lr,{scale:"x"}),we({},Lr,{scale:"y"})]},xr={scale:"y",auto:!0,sorted:0,show:!0,spanGaps:!1,gaps:Ir,alpha:1,points:{show:Vc,filter:null},values:null,min:q,max:-q,idxs:[],path:null,clip:null};function Hc(e,t,s,i,n){return s/10}var Dr={time:ca,auto:!0,distr:1,log:10,asinh:1,min:null,max:null,dir:1,ori:0},Uc=we({},Dr,{time:!1,ori:1}),Or={};function Mr(e,t){let s=Or[e];return s||(s={key:e,plots:[],sub(i){s.plots.push(i)},unsub(i){s.plots=s.plots.filter(n=>n!=i)},pub(i,n,r,o,u,c,f){for(let p=0;p<s.plots.length;p++)s.plots[p]!=n&&s.plots[p].pub(i,n,r,o,u,c,f)}},e!=null&&(Or[e]=s)),s}var Wt=1,ui=2;function Yt(e,t,s){const i=e.mode,n=e.series[t],r=i==2?e._data[t]:e._data,o=e.scales,u=e.bbox;let c=r[0],f=i==2?r[1]:r[t],p=i==2?o[n.facets[0].scale]:o[e.series[0].scale],m=i==2?o[n.facets[1].scale]:o[n.scale],h=u.left,b=u.top,_=u.width,y=u.height,A=e.valToPosH,I=e.valToPosV;return p.ori==0?s(n,c,f,p,m,A,I,h,b,_,y,pi,ps,gi,Fr,Nr):s(n,c,f,p,m,I,A,b,h,y,_,di,ds,cn,Cr,zr)}function fi(e,t){let s=0,i=0,n=le(e.bands,Zl);for(let r=0;r<n.length;r++){let o=n[r];o.series[0]==t?s=o.dir:o.series[1]==t&&(o.dir==1?i|=1:i|=2)}return[s,i==1?-1:i==2?1:i==3?2:0]}function Bc(e,t,s,i,n){let r=e.mode,o=e.series[t],u=r==2?o.facets[1].scale:o.scale,c=e.scales[u];return n==-1?c.min:n==1?c.max:c.distr==3?c.dir==1?c.min:c.max:0}function bt(e,t,s,i,n,r){return Yt(e,t,(o,u,c,f,p,m,h,b,_,y,A)=>{let I=o.pxRound;const O=f.dir*(f.ori==0?1:-1),w=f.ori==0?ps:ds;let x,E;O==1?(x=s,E=i):(x=i,E=s);let F=I(m(u[x],f,y,b)),R=I(h(c[x],p,A,_)),U=I(m(u[E],f,y,b)),N=I(h(r==1?p.max:p.min,p,A,_)),P=new Path2D(n);return w(P,U,N),w(P,F,N),w(P,F,R),P})}function hi(e,t,s,i,n,r){let o=null;if(e.length>0){o=new Path2D;const u=t==0?gi:cn;let c=s;for(let m=0;m<e.length;m++){let h=e[m];if(h[1]>h[0]){let b=h[0]-c;b>0&&u(o,c,i,b,i+r),c=h[1]}}let f=s+n-c,p=10;f>0&&u(o,c,i-p/2,f,i+r+p)}return o}function Gc(e,t,s){let i=e[e.length-1];i&&i[0]==t?i[1]=s:e.push([t,s])}function an(e,t,s,i,n,r,o){let u=[],c=e.length;for(let f=n==1?s:i;f>=s&&f<=i;f+=n)if(t[f]===null){let m=f,h=f;if(n==1)for(;++f<=i&&t[f]===null;)h=f;else for(;--f>=s&&t[f]===null;)h=f;let b=r(e[m]),_=h==m?b:r(e[h]),y=m-n;b=o<=0&&y>=0&&y<c?r(e[y]):b;let I=h+n;_=o>=0&&I>=0&&I<c?r(e[I]):_,_>=b&&u.push([b,_])}return u}function Rr(e){return e==0?Wl:e==1?Pe:t=>Gt(t,e)}function Pr(e){let t=e==0?pi:di,s=e==0?(n,r,o,u,c,f)=>{n.arcTo(r,o,u,c,f)}:(n,r,o,u,c,f)=>{n.arcTo(o,r,c,u,f)},i=e==0?(n,r,o,u,c)=>{n.rect(r,o,u,c)}:(n,r,o,u,c)=>{n.rect(o,r,c,u)};return(n,r,o,u,c,f=0,p=0)=>{f==0&&p==0?i(n,r,o,u,c):(f=tt(f,u/2,c/2),p=tt(p,u/2,c/2),t(n,r+f,o),s(n,r+u,o,r+u,o+c,f),s(n,r+u,o+c,r,o+c,p),s(n,r,o+c,r,o,p),s(n,r,o,r+u,o,f),n.closePath())}}var pi=(e,t,s)=>{e.moveTo(t,s)},di=(e,t,s)=>{e.moveTo(s,t)},ps=(e,t,s)=>{e.lineTo(t,s)},ds=(e,t,s)=>{e.lineTo(s,t)},gi=Pr(0),cn=Pr(1),Fr=(e,t,s,i,n,r)=>{e.arc(t,s,i,n,r)},Cr=(e,t,s,i,n,r)=>{e.arc(s,t,i,n,r)},Nr=(e,t,s,i,n,r,o)=>{e.bezierCurveTo(t,s,i,n,r,o)},zr=(e,t,s,i,n,r,o)=>{e.bezierCurveTo(s,t,n,i,o,r)};function Vr(e){return(t,s,i,n,r)=>Yt(t,s,(o,u,c,f,p,m,h,b,_,y,A)=>{let{pxRound:I,points:O}=o,w,x;f.ori==0?(w=pi,x=Fr):(w=di,x=Cr);const E=fe(O.width*ne,3);let F=(O.size-O.width)/2*ne,R=fe(F*2,3),U=new Path2D,N=new Path2D,{left:P,top:L,width:H,height:X}=t.bbox;gi(N,P-R,L-R,H+R*2,X+R*2);const K=Y=>{if(c[Y]!=null){let ae=I(m(u[Y],f,y,b)),W=I(h(c[Y],p,A,_));w(U,ae+F,W),x(U,ae,W,F,0,ni*2)}};if(r)r.forEach(K);else for(let Y=i;Y<=n;Y++)K(Y);return{stroke:E>0?U:null,fill:U,clip:N,flags:Wt|ui}})}function Hr(e){return(t,s,i,n,r,o)=>{i!=n&&(r!=i&&o!=i&&e(t,s,i),r!=n&&o!=n&&e(t,s,n),e(t,s,o))}}var $c=Hr(ps),Wc=Hr(ds);function Ur(e){const t=le(e?.alignGaps,0);return(s,i,n,r)=>Yt(s,i,(o,u,c,f,p,m,h,b,_,y,A)=>{let I=o.pxRound,O=B=>I(m(B,f,y,b)),w=B=>I(h(B,p,A,_)),x,E;f.ori==0?(x=ps,E=$c):(x=ds,E=Wc);const F=f.dir*(f.ori==0?1:-1),R={stroke:new Path2D,fill:null,clip:null,band:null,gaps:null,flags:Wt},U=R.stroke;let N=q,P=-q,L,H,X,K=O(u[F==1?n:r]),Y=ls(c,n,r,1*F),ae=ls(c,n,r,-1*F),W=O(u[Y]),Ce=O(u[ae]),Ne=!1;for(let B=F==1?n:r;B>=n&&B<=r;B+=F){let pe=O(u[B]),G=c[B];pe==K?G!=null?(H=w(G),N==q&&(x(U,pe,H),L=H),N=tt(H,N),P=Fe(H,P)):G===null&&(Ne=!0):(N!=q&&(E(U,K,N,P,L,H),X=K),G!=null?(H=w(G),x(U,pe,H),N=P=L=H):(N=q,P=-q,G===null&&(Ne=!0)),K=pe)}N!=q&&N!=P&&X!=K&&E(U,K,N,P,L,H);let[Q,ce]=fi(s,i);if(o.fill!=null||Q!=0){let B=R.fill=new Path2D(U),pe=o.fillTo(s,i,o.min,o.max,Q),G=w(pe);x(B,Ce,G),x(B,W,G)}if(!o.spanGaps){let B=[];Ne&&B.push(...an(u,c,n,r,F,O,t)),R.gaps=B=o.gaps(s,i,n,r,B),R.clip=hi(B,f.ori,b,_,y,A)}return ce!=0&&(R.band=ce==2?[bt(s,i,n,r,U,-1),bt(s,i,n,r,U,1)]:bt(s,i,n,r,U,ce)),R})}function Yc(e){const t=le(e.align,1),s=le(e.ascDesc,!1),i=le(e.alignGaps,0),n=le(e.extend,!1);return(r,o,u,c)=>Yt(r,o,(f,p,m,h,b,_,y,A,I,O,w)=>{let x=f.pxRound,{left:E,width:F}=r.bbox,R=Q=>x(_(Q,h,O,A)),U=Q=>x(y(Q,b,w,I)),N=h.ori==0?ps:ds;const P={stroke:new Path2D,fill:null,clip:null,band:null,gaps:null,flags:Wt},L=P.stroke,H=h.dir*(h.ori==0?1:-1);u=ls(m,u,c,1),c=ls(m,u,c,-1);let X=U(m[H==1?u:c]),K=R(p[H==1?u:c]),Y=K,ae=K;n&&t==-1&&(ae=E,N(L,ae,X)),N(L,K,X);for(let Q=H==1?u:c;Q>=u&&Q<=c;Q+=H){let ce=m[Q];if(ce==null)continue;let B=R(p[Q]),pe=U(ce);t==1?N(L,B,X):N(L,Y,pe),N(L,B,pe),X=pe,Y=B}let W=Y;n&&t==1&&(W=E+F,N(L,W,X));let[Ce,Ne]=fi(r,o);if(f.fill!=null||Ce!=0){let Q=P.fill=new Path2D(L),ce=f.fillTo(r,o,f.min,f.max,Ce),B=U(ce);N(Q,W,B),N(Q,ae,B)}if(!f.spanGaps){let Q=[];Q.push(...an(p,m,u,c,H,R,i));let ce=f.width*ne/2,B=s||t==1?ce:-ce,pe=s||t==-1?-ce:ce;Q.forEach(G=>{G[0]+=B,G[1]+=pe}),P.gaps=Q=f.gaps(r,o,u,c,Q),P.clip=hi(Q,h.ori,A,I,O,w)}return Ne!=0&&(P.band=Ne==2?[bt(r,o,u,c,L,-1),bt(r,o,u,c,L,1)]:bt(r,o,u,c,L,Ne)),P})}function jc(e){e=e||Rs;const t=le(e.size,[.6,q,1]),s=e.align||0,i=(e.gap||0)*ne;let n=e.radius;n=n==null?[0,0]:typeof n=="number"?[n,0]:n;const r=Z(n),o=1-t[0],u=le(t[1],q)*ne,c=le(t[2],1)*ne,f=le(e.disp,Rs),p=le(e.each,b=>{}),{fill:m,stroke:h}=f;return(b,_,y,A)=>Yt(b,_,(I,O,w,x,E,F,R,U,N,P,L)=>{let H=I.pxRound,X,K;x.ori==0?[X,K]=r(b,_):[K,X]=r(b,_);const Y=x.dir*(x.ori==0?1:-1),ae=E.dir*(E.ori==1?1:-1);let W=x.ori==0?gi:cn,Ce=x.ori==0?p:(z,he,Le,ke,Ge,xe,$e)=>{p(z,he,Le,Ge,ke,$e,xe)},[Ne,Q]=fi(b,_),ce=E.distr==3?Ne==1?E.max:E.min:0,B=R(ce,E,L,N),pe,G,te=H(I.width*ne),Et=!1,Tt=null,dt=null,Ot=null,At=null;m!=null&&(te==0||h!=null)&&(Et=!0,Tt=m.values(b,_,y,A),dt=new Map,new Set(Tt).forEach(z=>{z!=null&&dt.set(z,new Path2D)}),te>0&&(Ot=h.values(b,_,y,A),At=new Map,new Set(Ot).forEach(z=>{z!=null&&At.set(z,new Path2D)})));let{x0:rt,size:Xt}=f,Si=!0;if(rt!=null&&Xt!=null){O=rt.values(b,_,y,A),rt.unit==2&&(O=O.map(he=>b.posToVal(U+he*P,x.key,!0)));let z=Xt.values(b,_,y,A);Xt.unit==2?G=z[0]*P:G=F(z[0],x,P,U)-F(0,x,P,U),te>=G/2&&(te=0),G=H(li(G-te,c,u)),pe=Y==1?-te/2:G+te/2}else{let z=P;if(O.length>1){let Le=null;for(let ke=0,Ge=1/0;ke<O.length;ke++)if(w[ke]!==void 0){if(Le!=null){let xe=Ie(O[ke]-O[Le]);xe<Ge&&(Ge=xe,z=Ie(F(O[ke],x,P,U)-F(O[Le],x,P,U)))}Le=ke}}let he=z*o;G=z-he-i,te>=G/2&&(te=0),he+i<5&&(H=Wl),G=H(li(z-he,c,u)-te-i),pe=(s==0?G/2:s==Y?0:G)-s*Y*i/2,G+te>z&&(Si=!1)}const gt={stroke:null,fill:null,clip:null,band:null,gaps:null,flags:Wt|ui};let Cs;Q!=0&&(gt.band=new Path2D,Cs=H(R(Q==1?E.max:E.min,E,L,N)));const Ns=Et?null:new Path2D,Kt=gt.band;let{y0:st,y1:zs}=f,Mt=null;st!=null&&zs!=null&&(w=zs.values(b,_,y,A),Mt=st.values(b,_,y,A));let qt=X*G,se=K*G;for(let z=Y==1?y:A;z>=y&&z<=A;z+=Y){let he=w[z];if(he===void 0)continue;let Le=x.distr!=2||f!=null?O[z]:z,ke=F(Le,x,P,U),Ge=R(le(he,ce),E,L,N);Mt!=null&&he!=null&&(B=R(Mt[z],E,L,N));let xe=H(ke-pe),$e=H(Fe(Ge,B)),Ye=H(tt(Ge,B)),ot=$e-Ye;if(he!=null){let mt=he<0?se:qt,at=he<0?qt:se;Et?(te>0&&Ot[z]!=null&&W(At.get(Ot[z]),xe,Ye+Je(te/2),G,Fe(0,ot-te),mt,at),Tt[z]!=null&&W(dt.get(Tt[z]),xe,Ye+Je(te/2),G,Fe(0,ot-te),mt,at)):W(Ns,xe,Ye+Je(te/2),G,Fe(0,ot-te),mt,at),Ce(b,_,z,xe-te/2,Ye,G+te,ot)}Q!=0&&(he!=null||Si)&&(ae*Q==1?($e=Ye,Ye=Cs):(Ye=$e,$e=Cs),ot=$e-Ye,W(Kt,xe-te/2,Ye,G+te,Fe(0,ot),0,0))}return te>0?gt.stroke=Et?At:Ns:Et||(gt._fill=I.width==0?I._fill:I._stroke??I._fill,gt.width=0),gt.fill=Et?dt:Ns,gt})}function Xc(e,t){const s=le(t?.alignGaps,0);return(i,n,r,o)=>Yt(i,n,(u,c,f,p,m,h,b,_,y,A,I)=>{let O=u.pxRound,w=W=>O(h(W,p,A,_)),x=W=>O(b(W,m,I,y)),E,F,R;p.ori==0?(E=pi,R=ps,F=Nr):(E=di,R=ds,F=zr);const U=p.dir*(p.ori==0?1:-1);r=ls(f,r,o,1),o=ls(f,r,o,-1);let N=w(c[U==1?r:o]),P=N,L=[],H=[];for(let W=U==1?r:o;W>=r&&W<=o;W+=U)if(f[W]!=null){let Ne=c[W],Q=w(Ne);L.push(P=Q),H.push(x(f[W]))}const X={stroke:e(L,H,E,R,F,O),fill:null,clip:null,band:null,gaps:null,flags:Wt},K=X.stroke;let[Y,ae]=fi(i,n);if(u.fill!=null||Y!=0){let W=X.fill=new Path2D(K),Ce=u.fillTo(i,n,u.min,u.max,Y),Ne=x(Ce);R(W,P,Ne),R(W,N,Ne)}if(!u.spanGaps){let W=[];W.push(...an(c,f,r,o,U,w,s)),X.gaps=W=u.gaps(i,n,r,o,W),X.clip=hi(W,p.ori,_,y,A,I)}return ae!=0&&(X.band=ae==2?[bt(i,n,r,o,K,-1),bt(i,n,r,o,K,1)]:bt(i,n,r,o,K,ae)),X})}function Kc(e){return Xc(qc,e)}function qc(e,t,s,i,n,r){const o=e.length;if(o<2)return null;const u=new Path2D;if(s(u,e[0],t[0]),o==2)i(u,e[1],t[1]);else{let c=Array(o),f=Array(o-1),p=Array(o-1),m=Array(o-1);for(let h=0;h<o-1;h++)p[h]=t[h+1]-t[h],m[h]=e[h+1]-e[h],f[h]=p[h]/m[h];c[0]=f[0];for(let h=1;h<o-1;h++)f[h]===0||f[h-1]===0||f[h-1]>0!=f[h]>0?c[h]=0:(c[h]=3*(m[h-1]+m[h])/((2*m[h]+m[h-1])/f[h-1]+(m[h]+2*m[h-1])/f[h]),isFinite(c[h])||(c[h]=0));c[o-1]=f[o-2];for(let h=0;h<o-1;h++)n(u,e[h]+m[h]/3,t[h]+c[h]*m[h]/3,e[h+1]-m[h]/3,t[h+1]-c[h+1]*m[h]/3,e[h+1],t[h+1])}return u}var un=new Set;function Br(){for(let e of un)e.syncRect(!0)}ss&&(Bt(ka,is,Br),Bt(xa,is,Br,!0),Bt(ei,is,()=>{ee.pxRatio=ne}));var Zc=Ur(),Jc=Vr();function Gr(e,t,s,i){return(i?[e[0],e[1]].concat(e.slice(2)):[e[0]].concat(e.slice(1))).map((r,o)=>fn(r,o,t,s))}function Qc(e,t){return e.map((s,i)=>i==0?null:we({},t,s))}function fn(e,t,s,i){return we({},t==0?s:i,e)}function $r(e,t,s){return t==null?fs:[t,s]}var eu=$r;function tu(e,t,s){return t==null?fs:ii(t,s,Ki,!0)}function Wr(e,t,s,i){return t==null?fs:si(t,s,e.scales[i].log,!1)}var su=Wr;function Yr(e,t,s,i){return t==null?fs:Xi(t,s,e.scales[i].log,!1)}var iu=Yr;function nu(e,t,s,i,n){let r=Fe($l(e),$l(t)),o=t-e,u=xt(n/i*o,s);do{let c=s[u],f=i*c/o;if(f>=n&&r+(c<5?us.get(c):0)<=17)return[c,f]}while(++u<s.length);return[0,0]}function jr(e){let t,s;return e=e.replace(/(\d+)px/,(i,n)=>(t=Pe((s=+n)*ne))+"px"),[e,t,s]}function lu(e){e.show&&[e.font,e.labelFont].forEach(t=>{let s=fe(t[2]*ne,1);t[0]=t[0].replace(/[0-9.]+px/,s+"px"),t[1]=s})}function ee(e,t,s){const i={mode:le(e.mode,1)},n=i.mode;function r(l,a){return((a.distr==3?wt(l>0?l:a.clamp(i,l,a.min,a.max,a.key)):a.distr==4?Zi(l,a.asinh):l)-a._min)/(a._max-a._min)}function o(l,a,d,g){let v=r(l,a);return g+d*(a.dir==-1?1-v:v)}function u(l,a,d,g){let v=r(l,a);return g+d*(a.dir==-1?v:1-v)}function c(l,a,d,g){return a.ori==0?o(l,a,d,g):u(l,a,d,g)}i.valToPosH=o,i.valToPosV=u;let f=!1;i.status=0;const p=i.root=et(ua);if(e.id!=null&&(p.id=e.id),qe(p,e.class),e.title){let l=et(pa,p);l.textContent=e.title}const m=nt("canvas"),h=i.ctx=m.getContext("2d"),b=et(da,p);Bt("click",b,l=>{l.target===y&&(de!=vs||ge!=_s)&&Ve.click(i,l)},!0);const _=i.under=et(ga,b);b.appendChild(m);const y=i.over=et(ma,b);e=$t(e);const A=+le(e.pxAlign,1),I=Rr(A);(e.plugins||[]).forEach(l=>{l.opts&&(e=l.opts(i,e)||e)});const O=e.ms||.001,w=i.series=n==1?Gr(e.series||[],br,xr,!1):Qc(e.series||[null],kr),x=i.axes=Gr(e.axes||[],wr,Ar,!0),E=i.scales={},F=i.bands=e.bands||[];F.forEach(l=>{l.fill=Z(l.fill||null),l.dir=le(l.dir,-1)});const R=n==2?w[1].facets[0].scale:w[0].scale,U={axes:mf,series:ff},N=(e.drawOrder||["axes","series"]).map(l=>U[l]);function P(l){let a=E[l];if(a==null){let d=(e.scales||Rs)[l]||Rs;if(d.from!=null)P(d.from),E[l]=we({},E[d.from],d,{key:l});else{a=E[l]=we({},l==R?Dr:Uc,d),a.key=l;let g=a.time,v=a.range,S=Dt(v);if((l!=R||n==2&&!g)&&(S&&(v[0]==null||v[1]==null)&&(v={min:v[0]==null?Hl:{mode:1,hard:v[0],soft:v[0]},max:v[1]==null?Hl:{mode:1,hard:v[1],soft:v[1]}},S=!1),!S&&ri(v))){let T=v;v=(k,M,C)=>M==null?fs:ii(M,C,T)}a.range=Z(v||(g?eu:l==R?a.distr==3?su:a.distr==4?iu:$r:a.distr==3?Wr:a.distr==4?Yr:tu)),a.auto=Z(S?!1:a.auto),a.clamp=Z(a.clamp||Hc),a._min=a._max=null}}}P("x"),P("y"),n==1&&w.forEach(l=>{P(l.scale)}),x.forEach(l=>{P(l.scale)});for(let l in e.scales)P(l);const L=E[R],H=L.distr;let X,K;L.ori==0?(qe(p,fa),X=o,K=u):(qe(p,ha),X=u,K=o);const Y={};for(let l in E){let a=E[l];(a.min!=null||a.max!=null)&&(Y[l]={min:a.min,max:a.max},a.min=a.max=null)}const ae=e.tzDate||(l=>new Date(Pe(l/O))),W=e.fmtDate||Ji,Ce=O==1?hc(ae):gc(ae),Ne=pr(ae,hr(O==1?fc:dc,W)),Q=gr(ae,dr(vc,W)),ce=[],B=i.legend=we({},yc,e.legend),pe=B.show,G=B.markers;B.idxs=ce,G.width=Z(G.width),G.dash=Z(G.dash),G.stroke=Z(G.stroke),G.fill=Z(G.fill);let te,Et,Tt,dt=[],Ot=[],At,rt=!1,Xt={};if(B.live){const l=w[1]?w[1].values:null;rt=l!=null,At=rt?l(i,1,0):{_:0};for(let a in At)Xt[a]=Bi}if(pe)if(te=nt("table",ba,p),Tt=nt("tbody",null,te),B.mount(i,te),rt){Et=nt("thead",null,te,Tt);let l=nt("tr",null,Et);nt("th",null,l);for(var Si in At)nt("th",Il,l).textContent=Si}else qe(te,Ta),B.live&&qe(te,Ea);const gt={show:!0},Cs={show:!1};function Ns(l,a){if(a==0&&(rt||!B.live||n==2))return fs;let d=[],g=nt("tr",Aa,Tt,Tt.childNodes[a]);qe(g,l.class),l.show||qe(g,Ut);let v=nt("th",null,g);if(G.show){let k=et(La,v);if(a>0){let M=G.width(i,a);M&&(k.style.border=M+"px "+G.dash(i,a)+" "+G.stroke(i,a)),k.style.background=G.fill(i,a)}}let S=et(Il,v);S.textContent=l.label,a>0&&(G.show||(S.style.color=l.width>0?G.stroke(i,a):G.fill(i,a)),st("click",v,k=>{if($._lock)return;Zt(k);let M=w.indexOf(l);if((k.ctrlKey||k.metaKey)!=B.isolate){let C=w.some((D,V)=>V>0&&V!=M&&D.show);w.forEach((D,V)=>{V>0&&_t(V,C?V==M?gt:Cs:gt,!0,be.setSeries)})}else _t(M,{show:!l.show},!0,be.setSeries)},!1),Hs&&st(Ml,v,k=>{$._lock||(Zt(k),_t(w.indexOf(l),ws,!0,be.setSeries))},!1));for(var T in At){let k=nt("td",Ia,g);k.textContent="--",d.push(k)}return[g,d]}const Kt=new Map;function st(l,a,d,g=!0){const v=Kt.get(a)||{},S=$.bind[l](i,a,d,g);S&&(Bt(l,a,v[l]=S),Kt.set(a,v))}function zs(l,a,d){const g=Kt.get(a)||{};for(let v in g)(l==null||v==l)&&(ji(v,a,g[v]),delete g[v]);l==null&&Kt.delete(a)}let Mt=0,qt=0,se=0,z=0,he=0,Le=0,ke=0,Ge=0,xe=0,$e=0;i.bbox={};let Ye=!1,ot=!1,mt=!1,at=!1,mn=!1,it=!1;function vn(l,a,d){(d||l!=i.width||a!=i.height)&&oo(l,a),Gs(!1),mt=!0,ot=!0,$.left>=0&&(at=it=!0),Qt()}function oo(l,a){i.width=Mt=se=l,i.height=qt=z=a,he=Le=0,sf(),nf();let d=i.bbox;ke=d.left=Gt(he*ne,.5),Ge=d.top=Gt(Le*ne,.5),xe=d.width=Gt(se*ne,.5),$e=d.height=Gt(z*ne,.5)}const Qu=3;function ef(){let l=!1,a=0;for(;!l;){a++;let d=df(a),g=gf(a);l=a==Qu||d&&g,l||(oo(i.width,i.height),ot=!0)}}function tf({width:l,height:a}){vn(l,a)}i.setSize=tf;function sf(){let l=!1,a=!1,d=!1,g=!1;x.forEach((v,S)=>{if(v.show&&v._show){let{side:T,_size:k}=v,M=T%2,C=v.label!=null?v.labelSize:0,D=k+C;D>0&&(M?(se-=D,T==3?(he+=D,g=!0):d=!0):(z-=D,T==0?(Le+=D,l=!0):a=!0))}}),Jt[0]=l,Jt[1]=d,Jt[2]=a,Jt[3]=g,se-=Rt[1]+Rt[3],he+=Rt[3],z-=Rt[2]+Rt[0],Le+=Rt[0]}function nf(){let l=he+se,a=Le+z,d=he,g=Le;function v(S,T){switch(S){case 1:return l+=T,l-T;case 2:return a+=T,a-T;case 3:return d-=T,d+T;case 0:return g-=T,g+T}}x.forEach((S,T)=>{if(S.show&&S._show){let k=S.side;S._pos=v(k,S._size),S.label!=null&&(S._lpos=v(k,S.labelSize))}})}const $=i.cursor=we({},Ic,{drag:{y:n==2}},e.cursor),Zt=l=>{$.event=l};$.idxs=ce,$._lock=!1;let vt=$.points;vt.show=Z(vt.show),vt.size=Z(vt.size),vt.stroke=Z(vt.stroke),vt.width=Z(vt.width),vt.fill=Z(vt.fill);const Vs=i.focus=we({},e.focus||{alpha:.3},$.focus),Hs=Vs.prox>=0;let je=[null];function lf(l,a){if(a>0){let d=$.points.show(i,a);if(d)return qe(d,wa),qe(d,l.class),ns(d,-10,-10,se,z),y.insertBefore(d,je[a]),d}}function ao(l,a){if(n==1||a>0){let d=n==1&&E[l.scale].time,g=l.value;l.value=d?Jl(g)?gr(ae,dr(g,W)):g||Q:g||Nc,l.label=l.label||(d?xc:kc)}if(a>0){l.width=l.width==null?1:l.width,l.paths=l.paths||Zc||Ha,l.fillTo=Z(l.fillTo||Bc),l.pxAlign=+le(l.pxAlign,A),l.pxRound=Rr(l.pxAlign),l.stroke=Z(l.stroke||null),l.fill=Z(l.fill||null),l._stroke=l._fill=l._paths=l._focus=null;let d=zc(Fe(1,l.width),1),g=l.points=we({},{size:d,width:Fe(1,d*.2),stroke:l.stroke,space:d*2,paths:Jc,_stroke:null,_fill:null},l.points);g.show=Z(g.show),g.filter=Z(g.filter),g.fill=Z(g.fill),g.stroke=Z(g.stroke),g.paths=Z(g.paths),g.pxAlign=l.pxAlign}if(pe){let d=Ns(l,a);dt.splice(a,0,d[0]),Ot.splice(a,0,d[1]),B.values.push(null)}if($.show){ce.splice(a,0,null);let d=lf(l,a);d&&je.splice(a,0,d)}Ue("addSeries",a)}function rf(l,a){a=a??w.length,l=n==1?fn(l,a,br,xr):fn(l,a,null,kr),w.splice(a,0,l),ao(w[a],a)}i.addSeries=rf;function of(l){if(w.splice(l,1),pe){B.values.splice(l,1),Ot.splice(l,1);let a=dt.splice(l,1)[0];zs(null,a.firstChild),a.remove()}$.show&&(ce.splice(l,1),je.length>1&&je.splice(l,1)[0].remove()),Ue("delSeries",l)}i.delSeries=of;const Jt=[!1,!1,!1,!1];function af(l,a){if(l._show=l.show,l.show){let d=l.side%2,g=E[l.scale];g==null&&(l.scale=d?w[1].scale:R,g=E[l.scale]);let v=g.time;l.size=Z(l.size),l.space=Z(l.space),l.rotate=Z(l.rotate),Dt(l.incrs)&&l.incrs.forEach(T=>{!us.has(T)&&us.set(T,ql(T))}),l.incrs=Z(l.incrs||(g.distr==2?oc:v?O==1?uc:pc:ac)),l.splits=Z(l.splits||(v&&g.distr==1?Ce:g.distr==3?rn:g.distr==4?Mc:Oc)),l.stroke=Z(l.stroke),l.grid.stroke=Z(l.grid.stroke),l.ticks.stroke=Z(l.ticks.stroke),l.border.stroke=Z(l.border.stroke);let S=l.values;l.values=Dt(S)&&!Dt(S[0])?Z(S):v?Dt(S)?pr(ae,hr(S,W)):Jl(S)?mc(ae,S):S||Ne:S||Dc,l.filter=Z(l.filter||(g.distr>=3&&g.log==10?Fc:g.distr==3&&g.log==2?Cc:Yl)),l.font=jr(l.font),l.labelFont=jr(l.labelFont),l._size=l.size(i,null,a,0),l._space=l._rotate=l._incrs=l._found=l._splits=l._values=null,l._size>0&&(Jt[a]=!0,l._el=et(va,b))}}function Us(l,a,d,g){let[v,S,T,k]=d,M=a%2,C=0;return M==0&&(k||S)&&(C=a==0&&!v||a==2&&!T?Pe(wr.size/3):0),M==1&&(v||T)&&(C=a==1&&!S||a==3&&!k?Pe(Ar.size/2):0),C}const co=i.padding=(e.padding||[Us,Us,Us,Us]).map(l=>Z(le(l,Us))),Rt=i._padding=co.map((l,a)=>l(i,a,Jt,0));let ze,De=null,Oe=null;const yi=n==1?w[0].idxs:null;let ct=null,wi=!1;function uo(l,a){if(t=l==null?[]:$t(l,Ql),n==2){ze=0;for(let d=1;d<w.length;d++)ze+=t[d][0].length;i.data=t=l}else if(t[0]==null&&(t[0]=[]),i.data=t.slice(),ct=t[0],ze=ct.length,H==2){t[0]=Array(ze);for(let d=0;d<ze;d++)t[0][d]=d}if(i._data=t,Gs(!0),Ue("setData"),H==2&&(mt=!0),a!==!1){let d=L;d.auto(i,wi)?_n():Ss(R,d.min,d.max),at=at||$.left>=0,it=!0,Qt()}}i.setData=uo;function _n(){wi=!0;let l,a;n==1&&(ze>0?(De=yi[0]=0,Oe=yi[1]=ze-1,l=t[0][De],a=t[0][Oe],H==2?(l=De,a=Oe):l==a&&(H==3?[l,a]=si(l,l,L.log,!1):H==4?[l,a]=Xi(l,l,L.log,!1):L.time?a=l+Pe(86400/O):[l,a]=ii(l,a,Ki,!0))):(De=yi[0]=l=null,Oe=yi[1]=a=null)),Ss(R,l,a)}let bi,ms,Sn,yn,wn,bn,En,Tn,An,Bs;function fo(l,a,d,g,v,S){l??=xl,d??=Zl,g??="butt",v??=xl,S??="round",l!=bi&&(h.strokeStyle=bi=l),v!=ms&&(h.fillStyle=ms=v),a!=Sn&&(h.lineWidth=Sn=a),S!=wn&&(h.lineJoin=wn=S),g!=bn&&(h.lineCap=bn=g),d!=yn&&h.setLineDash(yn=d)}function ho(l,a,d,g){a!=ms&&(h.fillStyle=ms=a),l!=En&&(h.font=En=l),d!=Tn&&(h.textAlign=Tn=d),g!=An&&(h.textBaseline=An=g)}function Ln(l,a,d,g,v=0){if(g.length>0&&l.auto(i,wi)&&(a==null||a.min==null)){let S=le(De,0),T=le(Oe,g.length-1),k=d.min==null?l.distr==3?Pa(g,S,T):Ra(g,S,T,v):[d.min,d.max];l.min=tt(l.min,d.min=k[0]),l.max=Fe(l.max,d.max=k[1])}}function cf(){let l=$t(E,Ql);for(let g in l){let v=l[g],S=Y[g];if(S!=null&&S.min!=null)we(v,S),g==R&&Gs(!0);else if(g!=R||n==2)if(ze==0&&v.from==null){let T=v.range(i,null,null,g);v.min=T[0],v.max=T[1]}else v.min=q,v.max=-q}if(ze>0){w.forEach((g,v)=>{if(n==1){let S=g.scale,T=l[S],k=Y[S];if(v==0){let M=T.range(i,T.min,T.max,S);T.min=M[0],T.max=M[1],De=xt(T.min,t[0]),Oe=xt(T.max,t[0]),Oe-De>1&&(t[0][De]<T.min&&De++,t[0][Oe]>T.max&&Oe--),g.min=ct[De],g.max=ct[Oe]}else g.show&&g.auto&&Ln(T,k,g,t[v],g.sorted);g.idxs[0]=De,g.idxs[1]=Oe}else if(v>0&&g.show&&g.auto){let[S,T]=g.facets,k=S.scale,M=T.scale,[C,D]=t[v];Ln(l[k],Y[k],S,C,S.sorted),Ln(l[M],Y[M],T,D,T.sorted),g.min=T.min,g.max=T.max}});for(let g in l){let v=l[g],S=Y[g];if(v.from==null&&(S==null||S.min==null)){let T=v.range(i,v.min==q?null:v.min,v.max==-q?null:v.max,g);v.min=T[0],v.max=T[1]}}}for(let g in l){let v=l[g];if(v.from!=null){let S=l[v.from];if(S.min==null)v.min=v.max=null;else{let T=v.range(i,S.min,S.max,g);v.min=T[0],v.max=T[1]}}}let a={},d=!1;for(let g in l){let v=l[g],S=E[g];if(S.min!=v.min||S.max!=v.max){S.min=v.min,S.max=v.max;let T=S.distr;S._min=T==3?wt(S.min):T==4?Zi(S.min,S.asinh):S.min,S._max=T==3?wt(S.max):T==4?Zi(S.max,S.asinh):S.max,a[g]=d=!0}}if(d){w.forEach((g,v)=>{n==2?v>0&&a.y&&(g._paths=null):a[g.scale]&&(g._paths=null)});for(let g in a)mt=!0,Ue("setScale",g);$.show&&$.left>=0&&(at=it=!0)}for(let g in Y)Y[g]=null}function uf(l){let a=li(De-1,0,ze-1),d=li(Oe+1,0,ze-1);for(;l[a]==null&&a>0;)a--;for(;l[d]==null&&d<ze-1;)d++;return[a,d]}function ff(){ze>0&&(w.forEach((l,a)=>{if(a>0&&l.show&&(po(a,!1),po(a,!0),l._paths==null)){let d=n==2?[0,t[a][0].length-1]:uf(t[a]);l._paths=l.paths(i,a,d[0],d[1])}}),w.forEach((l,a)=>{if(a>0&&l.show){Bs!=l.alpha&&(h.globalAlpha=Bs=l.alpha),l._paths!=null&&go(a,!1);{let d=l._paths!=null?l._paths.gaps:null,g=l.points.show(i,a,De,Oe,d),v=l.points.filter(i,a,g,d);(g||v)&&(l.points._paths=l.points.paths(i,a,De,Oe,v),go(a,!0))}Bs!=1&&(h.globalAlpha=Bs=1),Ue("drawSeries",a)}}))}function po(l,a){let d=a?w[l].points:w[l];d._stroke=d.stroke(i,l),d._fill=d.fill(i,l)}function go(l,a){let d=a?w[l].points:w[l],{stroke:g,fill:v,clip:S,flags:T,_stroke:k=d._stroke,_fill:M=d._fill,_width:C=d.width}=d._paths;C=fe(C*ne,3);let D=null,V=C%2/2;a&&M==null&&(M=C>0?"#fff":k);let j=d.pxAlign==1&&V>0;if(j&&h.translate(V,V),!a){let Se=ke-C/2,J=Ge-C/2,re=xe+C,ie=$e+C;D=new Path2D,D.rect(Se,J,re,ie)}a?In(k,C,d.dash,d.cap,M,g,v,T,S):hf(l,k,C,d.dash,d.cap,M,g,v,T,D,S),j&&h.translate(-V,-V)}function hf(l,a,d,g,v,S,T,k,M,C,D){let V=!1;F.forEach((j,Se)=>{if(j.series[0]==l){let J=w[j.series[1]],re=t[j.series[1]],ie=(J._paths||Rs).band;Dt(ie)&&(ie=j.dir==1?ie[0]:ie[1]);let ue,_e=null;J.show&&ie&&Ca(re,De,Oe)?(_e=j.fill(i,Se)||S,ue=J._paths.clip):ie=null,In(a,d,g,v,_e,T,k,M,C,D,ue,ie),V=!0}}),V||In(a,d,g,v,S,T,k,M,C,D)}const mo=Wt|ui;function In(l,a,d,g,v,S,T,k,M,C,D,V){fo(l,a,d,g,v),(M||C||V)&&(h.save(),M&&h.clip(M),C&&h.clip(C)),V?(k&mo)==mo?(h.clip(V),D&&h.clip(D),Ti(v,T),Ei(l,S,a)):k&ui?(Ti(v,T),h.clip(V),Ei(l,S,a)):k&Wt&&(h.save(),h.clip(V),D&&h.clip(D),Ti(v,T),h.restore(),Ei(l,S,a)):(Ti(v,T),Ei(l,S,a)),(M||C||V)&&h.restore()}function Ei(l,a,d){d>0&&(a instanceof Map?a.forEach((g,v)=>{h.strokeStyle=bi=v,h.stroke(g)}):a!=null&&l&&h.stroke(a))}function Ti(l,a){a instanceof Map?a.forEach((d,g)=>{h.fillStyle=ms=g,h.fill(d)}):a!=null&&l&&h.fill(a)}function pf(l,a,d,g){let v=x[l],S;if(g<=0)S=[0,0];else{let T=v._space=v.space(i,l,a,d,g),k=v._incrs=v.incrs(i,l,a,d,g,T);S=nu(a,d,k,g,T)}return v._found=S}function kn(l,a,d,g,v,S,T,k,M,C){let D=T%2/2;A==1&&h.translate(D,D),fo(k,T,M,C,k),h.beginPath();let V,j,Se,J,re=v+(g==0||g==3?-S:S);d==0?(j=v,J=re):(V=v,Se=re);for(let ie=0;ie<l.length;ie++)a[ie]!=null&&(d==0?V=Se=l[ie]:j=J=l[ie],h.moveTo(V,j),h.lineTo(Se,J));h.stroke(),A==1&&h.translate(-D,-D)}function df(l){let a=!0;return x.forEach((d,g)=>{if(!d.show)return;let v=E[d.scale];if(v.min==null){d._show&&(a=!1,d._show=!1,Gs(!1));return}else d._show||(a=!1,d._show=!0,Gs(!1));let S=d.side,T=S%2,{min:k,max:M}=v,[C,D]=pf(g,k,M,T==0?se:z);if(D==0)return;let V=v.distr==2,j=d._splits=d.splits(i,g,k,M,C,D,V),Se=v.distr==2?j.map(ue=>ct[ue]):j,J=v.distr==2?ct[j[1]]-ct[j[0]]:C,re=d._values=d.values(i,d.filter(i,Se,g,D,J),g,D,J);d._rotate=S==2?d.rotate(i,re,g,D):0;let ie=d._size;d._size=rs(d.size(i,re,g,l)),ie!=null&&d._size!=ie&&(a=!1)}),a}function gf(l){let a=!0;return co.forEach((d,g)=>{let v=d(i,g,Jt,l);v!=Rt[g]&&(a=!1),Rt[g]=v}),a}function mf(){for(let l=0;l<x.length;l++){let a=x[l];if(!a.show||!a._show)continue;let d=a.side,g=d%2,v,S,T=a.stroke(i,l),k=d==0||d==3?-1:1;if(a.label){let ft=a.labelGap*k,Lt=Pe((a._lpos+ft)*ne);ho(a.labelFont[0],T,"center",d==2?Ds:kl),h.save(),g==1?(v=S=0,h.translate(Lt,Pe(Ge+$e/2)),h.rotate((d==3?-ni:ni)/2)):(v=Pe(ke+xe/2),S=Lt),h.fillText(a.label,v,S),h.restore()}let[M,C]=a._found;if(C==0)continue;let D=E[a.scale],V=g==0?xe:$e,j=g==0?ke:Ge,Se=Pe(a.gap*ne),J=a._splits,re=D.distr==2?J.map(ft=>ct[ft]):J,ie=D.distr==2?ct[J[1]]-ct[J[0]]:M,ue=a.ticks,_e=a.border,Xe=ue.show?Pe(ue.size*ne):0,me=a._rotate*-ni/180,Ee=I(a._pos*ne),Be=(Xe+Se)*k,ye=Ee+Be;S=g==0?ye:0,v=g==1?ye:0;let We=a.font[0],ut=a.align==1?ts:a.align==2?Vi:me>0?ts:me<0?Vi:g==0?"center":d==3?Vi:ts,Ct=me||g==1?"middle":d==2?Ds:kl;ho(We,T,ut,Ct);let Fo=a.font[1]*a.lineGap,Di=J.map(ft=>I(c(ft,D,V,j))),Co=a._values;for(let ft=0;ft<Co.length;ft++){let Lt=Co[ft];if(Lt!=null){g==0?v=Di[ft]:S=Di[ft],Lt=""+Lt;let No=Lt.indexOf(`
`)==-1?[Lt]:Lt.split(/\n/gm);for(let Zs=0;Zs<No.length;Zs++){let zo=No[Zs];me?(h.save(),h.translate(v,S+Zs*Fo),h.rotate(me),h.fillText(zo,0,0),h.restore()):h.fillText(zo,v,S+Zs*Fo)}}}ue.show&&kn(Di,ue.filter(i,re,l,C,ie),g,d,Ee,Xe,fe(ue.width*ne,3),ue.stroke(i,l),ue.dash,ue.cap);let Es=a.grid;Es.show&&kn(Di,Es.filter(i,re,l,C,ie),g,g==0?2:1,g==0?Ge:ke,g==0?$e:xe,fe(Es.width*ne,3),Es.stroke(i,l),Es.dash,Es.cap),_e.show&&kn([Ee],[1],g==0?1:0,g==0?1:2,g==1?Ge:ke,g==1?$e:xe,fe(_e.width*ne,3),_e.stroke(i,l),_e.dash,_e.cap)}Ue("drawAxes")}function Gs(l){w.forEach((a,d)=>{d>0&&(a._paths=null,l&&(n==1?(a.min=null,a.max=null):a.facets.forEach(g=>{g.min=null,g.max=null})))})}let xn=!1;function Qt(){xn||(Ka(vf),xn=!0)}function vf(){Ye&&(cf(),Ye=!1),mt&&(ef(),mt=!1),ot&&(ve(_,ts,he),ve(_,Ds,Le),ve(_,ks,se),ve(_,xs,z),ve(y,ts,he),ve(y,Ds,Le),ve(y,ks,se),ve(y,xs,z),ve(b,ks,Mt),ve(b,xs,qt),m.width=Pe(Mt*ne),m.height=Pe(qt*ne),x.forEach(({_el:l,_show:a,_size:d,_pos:g,side:v})=>{if(l!=null)if(a){let S=v===3||v===0?d:0,T=v%2==1;ve(l,T?"left":"top",g-S),ve(l,T?"width":"height",d),ve(l,T?"top":"left",T?Le:he),ve(l,T?"height":"width",T?z:se),Wi(l,Ut)}else qe(l,Ut)}),bi=ms=Sn=wn=bn=En=Tn=An=yn=null,Bs=1,Ks(!0),Ue("setSize"),ot=!1),Mt>0&&qt>0&&(h.clearRect(0,0,m.width,m.height),Ue("drawClear"),N.forEach(l=>l()),Ue("draw")),He.show&&mn&&(Ii(He),mn=!1),$.show&&at&&(es(null,!0,!1),at=!1),B.show&&B.live&&it&&(Rn(),it=!1),f||(f=!0,i.status=1,Ue("ready")),wi=!1,xn=!1}i.redraw=(l,a)=>{mt=a||!1,l!==!1?Ss(R,L.min,L.max):Qt()};function Dn(l,a){let d=E[l];if(d.from==null){if(ze==0){let g=d.range(i,a.min,a.max,l);a.min=g[0],a.max=g[1]}if(a.min>a.max){let g=a.min;a.min=a.max,a.max=g}if(ze>1&&a.min!=null&&a.max!=null&&a.max-a.min<1e-16)return;l==R&&d.distr==2&&ze>0&&(a.min=xt(a.min,t[0]),a.max=xt(a.max,t[0]),a.min==a.max&&a.max++),Y[l]=a,Ye=!0,Qt()}}i.setScale=Dn;let On,Mn,Ai,Li,vo,_o,vs,_s,So,yo,de,ge,Pt=!1;const Ve=$.drag;let Me=Ve.x,Re=Ve.y;$.show&&($.x&&(On=et(Sa,y)),$.y&&(Mn=et(ya,y)),L.ori==0?(Ai=On,Li=Mn):(Ai=Mn,Li=On),de=$.left,ge=$.top);const He=i.select=we({show:!0,over:!0,left:0,width:0,top:0,height:0},e.select),$s=He.show?et(_a,He.over?y:_):null;function Ii(l,a){if(He.show){for(let d in l)He[d]=l[d],d in To&&ve($s,d,l[d]);a!==!1&&Ue("setSelect")}}i.setSelect=Ii;function _f(l,a){let d=w[l],g=pe?dt[l]:null;d.show?g&&Wi(g,Ut):(g&&qe(g,Ut),je.length>1&&ns(je[l],-10,-10,se,z))}function Ss(l,a,d){Dn(l,{min:a,max:d})}function _t(l,a,d,g){a.focus!=null&&Ef(l),a.show!=null&&w.forEach((v,S)=>{S>0&&(l==S||l==null)&&(v.show=a.show,_f(S,a.show),Ss(n==2?v.facets[1].scale:v.scale,null,null),Qt())}),d!==!1&&Ue("setSeries",l,a),g&&qs("setSeries",i,l,a)}i.setSeries=_t;function Sf(l,a){we(F[l],a)}function yf(l,a){l.fill=Z(l.fill||null),l.dir=le(l.dir,-1),a=a??F.length,F.splice(a,0,l)}function wf(l){l==null?F.length=0:F.splice(l,1)}i.addBand=yf,i.setBand=Sf,i.delBand=wf;function bf(l,a){w[l].alpha=a,$.show&&je[l]&&(je[l].style.opacity=a),pe&&dt[l]&&(dt[l].style.opacity=a)}let ys,Ws,Ys;const ws={focus:!0};function Ef(l){if(l!=Ys){let a=l==null,d=Vs.alpha!=1;w.forEach((g,v)=>{let S=a||v==0||v==l;g._focus=a?null:S,d&&bf(v,S?1:Vs.alpha)}),Ys=l,d&&Qt()}}pe&&Hs&&st(Rl,te,l=>{$._lock||(Zt(l),Ys!=null&&_t(null,ws,!0,be.setSeries))});function St(l,a,d){let g=E[a];d&&(l=l/ne-(g.ori==1?Le:he));let v=se;g.ori==1&&(v=z,l=v-l),g.dir==-1&&(l=v-l);let S=g._min,T=g._max,k=l/v,M=S+(T-S)*k,C=g.distr;return C==3?os(10,M):C==4?za(M,g.asinh):M}function Tf(l,a){let d=St(l,R,a);return xt(d,t[0],De,Oe)}i.valToIdx=l=>xt(l,t[0]),i.posToIdx=Tf,i.posToVal=St,i.valToPos=(l,a,d)=>E[a].ori==0?o(l,E[a],d?xe:se,d?ke:0):u(l,E[a],d?$e:z,d?Ge:0);function Af(l){l(i),Qt()}i.batch=Af,i.setCursor=(l,a,d)=>{de=l.left,ge=l.top,es(null,a,d)};function wo(l,a){ve($s,ts,He.left=l),ve($s,ks,He.width=a)}function bo(l,a){ve($s,Ds,He.top=l),ve($s,xs,He.height=a)}let js=L.ori==0?wo:bo,Xs=L.ori==1?wo:bo;function Lf(){if(pe&&B.live)for(let l=n==2?1:0;l<w.length;l++){if(l==0&&rt)continue;let a=B.values[l],d=0;for(let g in a)Ot[l][d++].firstChild.nodeValue=a[g]}}function Rn(l,a){l!=null&&(l.idxs?l.idxs.forEach((d,g)=>{ce[g]=d}):Ba(l.idx)||ce.fill(l.idx),B.idx=ce[0]);for(let d=0;d<w.length;d++)(d>0||n==1&&!rt)&&If(d,ce[d]);pe&&B.live&&Lf(),it=!1,a!==!1&&Ue("setLegend")}i.setLegend=Rn;function If(l,a){let d=w[l],g=l==0&&H==2?ct:t[l],v;rt?v=d.values(i,l,a)??Xt:(v=d.value(i,a==null?null:g[a],l,a),v=v==null?Xt:{_:v}),B.values[l]=v}function es(l,a,d){So=de,yo=ge,[de,ge]=$.move(i,de,ge),$.show&&(Ai&&ns(Ai,Pe(de),0,se,z),Li&&ns(Li,0,Pe(ge),se,z));let g,v=De>Oe;ys=q;let S=L.ori==0?se:z,T=L.ori==1?se:z;if(de<0||ze==0||v){g=null;for(let k=0;k<w.length;k++)k>0&&je.length>1&&ns(je[k],-10,-10,se,z);Hs&&_t(null,ws,!0,l==null&&be.setSeries),B.live&&(ce.fill(g),it=!0)}else{let k,M,C;n==1&&(k=L.ori==0?de:ge,M=St(k,R),g=xt(M,t[0],De,Oe),C=X(t[0][g],L,S,0));for(let D=n==2?1:0;D<w.length;D++){let V=w[D],j=ce[D],Se=n==1?t[D][j]:t[D][1][j],J=$.dataIdx(i,D,g,M),re=n==1?t[D][J]:t[D][1][J];it=it||re!=Se||J!=j,ce[D]=J;let ie=cs(J==g?C:X(n==1?t[0][J]:t[D][0][J],L,S,0),1);if(D>0&&V.show){let ue=re==null?-10:cs(K(re,n==1?E[V.scale]:E[V.facets[1].scale],T,0),1);if(Hs&&ue>=0&&n==1){let me=Ie(ue-ge);if(me<ys){let Ee=Vs.bias;if(Ee!=0){let Be=L.ori==1?de:ge,ye=St(Be,V.scale),We=re>=0?1:-1,ut=ye>=0?1:-1;ut==We&&(ut==1?Ee==1?re>=ye:re<=ye:Ee==1?re<=ye:re>=ye)&&(ys=me,Ws=D)}else ys=me,Ws=D}}let _e,Xe;if(L.ori==0?(_e=ie,Xe=ue):(_e=ue,Xe=ie),it&&je.length>1){Oa(je[D],$.points.fill(i,D),$.points.stroke(i,D));let me,Ee,Be,ye,We=!0,ut=$.points.bbox;if(ut!=null){We=!1;let Ct=ut(i,D);Be=Ct.left,ye=Ct.top,me=Ct.width,Ee=Ct.height}else Be=_e,ye=Xe,me=Ee=$.points.size(i,D);Ma(je[D],me,Ee,We),ns(je[D],Be,ye,se,z)}}}}if($.idx=g,$.left=de,$.top=ge,it&&(B.idx=g,Rn()),He.show&&Pt)if(l!=null){let[k,M]=be.scales,[C,D]=be.match,[V,j]=l.cursor.sync.scales,Se=l.cursor.drag;if(Me=Se._x,Re=Se._y,Me||Re){let{left:J,top:re,width:ie,height:ue}=l.select,_e=l.scales[k].ori,Xe=l.posToVal,me,Ee,Be,ye,We,ut=k!=null&&C(k,V),Ct=M!=null&&D(M,j);ut&&Me?(_e==0?(me=J,Ee=ie):(me=re,Ee=ue),Be=E[k],ye=X(Xe(me,V),Be,S,0),We=X(Xe(me+Ee,V),Be,S,0),js(tt(ye,We),Ie(We-ye))):js(0,S),Ct&&Re?(_e==1?(me=J,Ee=ie):(me=re,Ee=ue),Be=E[M],ye=K(Xe(me,j),Be,T,0),We=K(Xe(me+Ee,j),Be,T,0),Xs(tt(ye,We),Ie(We-ye))):Xs(0,T)}else ki()}else{let k=Ie(So-vo),M=Ie(yo-_o);if(L.ori==1){let j=k;k=M,M=j}Me=Ve.x&&k>=Ve.dist,Re=Ve.y&&M>=Ve.dist;let C=Ve.uni;C!=null?Me&&Re&&(Me=k>=C,Re=M>=C,!Me&&!Re&&(M>k?Re=!0:Me=!0)):Ve.x&&Ve.y&&(Me||Re)&&(Me=Re=!0);let D,V;Me&&(L.ori==0?(D=vs,V=de):(D=_s,V=ge),js(tt(D,V),Ie(V-D)),Re||Xs(0,T)),Re&&(L.ori==1?(D=vs,V=de):(D=_s,V=ge),Xs(tt(D,V),Ie(V-D)),Me||js(0,S)),!Me&&!Re&&(js(0,0),Xs(0,0))}if(Ve._x=Me,Ve._y=Re,l==null){if(d){if(Po!=null){let[k,M]=be.scales;be.values[0]=k!=null?St(L.ori==0?de:ge,k):null,be.values[1]=M!=null?St(L.ori==1?de:ge,M):null}qs(Dl,i,de,ge,se,z,g)}if(Hs){let k=d&&be.setSeries,M=Vs.prox;Ys==null?ys<=M&&_t(Ws,ws,!0,k):ys>M?_t(null,ws,!0,k):Ws!=Ys&&_t(Ws,ws,!0,k)}}a!==!1&&Ue("setCursor")}let Ft=null;Object.defineProperty(i,"rect",{get(){return Ft==null&&Ks(!1),Ft}});function Ks(l=!1){l?Ft=null:(Ft=y.getBoundingClientRect(),Ue("syncRect",Ft))}function Eo(l,a,d,g,v,S,T){$._lock||Pt&&l!=null&&l.movementX==0&&l.movementY==0||(Pn(l,a,d,g,v,S,T,!1,l!=null),l!=null?es(null,!0,!0):es(a,!0,!1))}function Pn(l,a,d,g,v,S,T,k,M){if(Ft==null&&Ks(!1),Zt(l),l!=null)d=l.clientX-Ft.left,g=l.clientY-Ft.top;else{if(d<0||g<0){de=-10,ge=-10;return}let[C,D]=be.scales,V=a.cursor.sync,[j,Se]=V.values,[J,re]=V.scales,[ie,ue]=be.match,_e=a.axes[0].side%2==1,Xe=L.ori==0?se:z,me=L.ori==1?se:z,Ee=_e?S:v,Be=_e?v:S,ye=_e?g:d,We=_e?d:g;if(J!=null?d=ie(C,J)?c(j,E[C],Xe,0):-10:d=Xe*(ye/Ee),re!=null?g=ue(D,re)?c(Se,E[D],me,0):-10:g=me*(We/Be),L.ori==1){let ut=d;d=g,g=ut}}M&&((d<=1||d>=se-1)&&(d=Gt(d,se)),(g<=1||g>=z-1)&&(g=Gt(g,z))),k?(vo=d,_o=g,[vs,_s]=$.move(i,d,g)):(de=d,ge=g)}const To={width:0,height:0,left:0,top:0};function ki(){Ii(To,!1)}let Ao,Lo,Io,ko;function xo(l,a,d,g,v,S,T){Pt=!0,Me=Re=Ve._x=Ve._y=!1,Pn(l,a,d,g,v,S,T,!0,!1),l!=null&&(st(Ui,Gi,Do,!1),qs(Ol,i,vs,_s,se,z,null));let{left:k,top:M,width:C,height:D}=He;Ao=k,Lo=M,Io=C,ko=D,ki()}function Do(l,a,d,g,v,S,T){Pt=Ve._x=Ve._y=!1,Pn(l,a,d,g,v,S,T,!1,!0);let{left:k,top:M,width:C,height:D}=He,V=C>0||D>0,j=Ao!=k||Lo!=M||Io!=C||ko!=D;if(V&&j&&Ii(He),Ve.setScale&&V&&j){let Se=k,J=C,re=M,ie=D;if(L.ori==1&&(Se=M,J=D,re=k,ie=C),Me&&Ss(R,St(Se,R),St(Se+J,R)),Re)for(let ue in E){let _e=E[ue];ue!=R&&_e.from==null&&_e.min!=q&&Ss(ue,St(re+ie,ue),St(re,ue))}ki()}else $.lock&&($._lock=!$._lock,$._lock||es(null,!0,!1));l!=null&&(zs(Ui,Gi),qs(Ui,i,de,ge,se,z,null))}function kf(l,a,d,g,v,S,T){if($._lock)return;Zt(l);let k=Pt;if(Pt){let M=!0,C=!0,D=10,V,j;L.ori==0?(V=Me,j=Re):(V=Re,j=Me),V&&j&&(M=de<=D||de>=se-D,C=ge<=D||ge>=z-D),V&&M&&(de=de<vs?0:se),j&&C&&(ge=ge<_s?0:z),es(null,!0,!0),Pt=!1}de=-10,ge=-10,es(null,!0,!0),k&&(Pt=k)}function Oo(l,a,d,g,v,S,T){$._lock||(Zt(l),_n(),ki(),l!=null&&qs(Pl,i,de,ge,se,z,null))}function Mo(){x.forEach(lu),vn(i.width,i.height,!0)}Bt(ei,is,Mo);const bs={};bs.mousedown=xo,bs.mousemove=Eo,bs.mouseup=Do,bs.dblclick=Oo,bs.setSeries=(l,a,d,g)=>{let v=be.match[2];d=v(i,a,d),d!=-1&&_t(d,g,!0,!1)},$.show&&(st(Ol,y,xo),st(Dl,y,Eo),st(Ml,y,l=>{Zt(l),Ks(!1)}),st(Rl,y,kf),st(Pl,y,Oo),un.add(i),i.syncRect=Ks);const xi=i.hooks=e.hooks||{};function Ue(l,a,d){l in xi&&xi[l].forEach(g=>{g.call(null,i,a,d)})}(e.plugins||[]).forEach(l=>{for(let a in l.hooks)xi[a]=(xi[a]||[]).concat(l.hooks[a])});const Ro=(l,a,d)=>d,be=we({key:null,setSeries:!1,filters:{pub:jl,sub:jl},scales:[R,w[1]?w[1].scale:null],match:[Xl,Xl,Ro],values:[null,null]},$.sync);be.match.length==2&&be.match.push(Ro),$.sync=be;const Po=be.key,Fn=Mr(Po);function qs(l,a,d,g,v,S,T){be.filters.pub(l,a,d,g,v,S,T)&&Fn.pub(l,a,d,g,v,S,T)}Fn.sub(i);function xf(l,a,d,g,v,S,T){be.filters.sub(l,a,d,g,v,S,T)&&bs[l](null,a,d,g,v,S,T)}i.pub=xf;function Df(){Fn.unsub(i),un.delete(i),Kt.clear(),ji(ei,is,Mo),p.remove(),te?.remove(),Ue("destroy")}i.destroy=Df;function Cn(){Ue("init",e,t),uo(t||e.data,!1),Y[R]?Dn(R,Y[R]):_n(),mn=He.show&&(He.width>0||He.height>0),at=it=!0,vn(e.width,e.height)}return w.forEach(ao),x.forEach(af),s?s instanceof HTMLElement?(s.appendChild(p),Cn()):s(i,Cn):Cn(),i}ee.assign=we,ee.fmtNum=qi,ee.rangeNum=ii,ee.rangeLog=si,ee.rangeAsinh=Xi,ee.orient=Yt,ee.pxRatio=ne,ee.join=Xa,ee.fmtDate=Ji,ee.tzDate=lc,ee.sync=Mr;{ee.addGap=Gc,ee.clipGaps=hi;let e=ee.paths={points:Vr};e.linear=Ur,e.stepped=Yc,e.bars=jc,e.spline=Kc}var Xr={ru:{"hide-all":"\u0421\u043A\u0440\u044B\u0442\u044C \u0432\u0441\u0435","show-all":"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u0432\u0441\u0435",sum:"\u0421\u0443\u043C\u043C\u0430",scale:"\u0428\u043A\u0430\u043B\u0430",series:"\u041B\u0438\u043D\u0438\u044F",weekend:"\u0412\u044B\u0445\u043E\u0434\u043D\u043E\u0439",nodata:"\u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445"},en:{"hide-all":"Hide all","show-all":"Show all",sum:"Total",scale:"Scale",series:"Series",weekend:"Weekend",nodata:"No data"}},Kr=(e="en")=>(typeof e!="string"&&(Xr.custom=e,e="custom"),t=>Xr[e][t]||t),ru={size:["height","width"],clientSize:["clientHeight","clientWidth"],offsetSize:["offsetHeight","offsetWidth"],maxSize:["maxHeight","maxWidth"],before:["top","left"],marginBefore:["marginTop","marginLeft"],after:["bottom","right"],marginAfter:["marginBottom","marginRight"],scrollOffset:["pageYOffset","pageXOffset"],offset:["offsetY","offsetY"],offsetOpt:["yOffset","xOffset"]};function qr(e){return{top:e.top,bottom:e.bottom,left:e.left,right:e.right}}function ou(e,t,s="bottom",i={}){let n;t instanceof Element||t instanceof Range?n=qr(e.getBoundingClientRect()):n=t;const r=Object.assign({top:n.bottom||0,bottom:n.top||0,left:n.right||0,right:n.left||0},n),o={top:0,left:0,bottom:window.innerHeight,right:window.innerWidth};i.bound&&((i.bound instanceof Element||i.bound instanceof Range)&&(i.bound=qr(i.bound.getBoundingClientRect())),Object.assign(o,i.bound));const u=getComputedStyle(e),{primary:c,secondary:f}=Object.entries(ru).reduce((N,[P,L])=>({primary:{...N.primary,[P]:L[s==="top"||s==="bottom"?0:1]},secondary:{...N.secondary,[P]:L[s==="top"||s==="bottom"?1:0]}}),{primary:{},secondary:{}});e.style.position="absolute",e.style.maxWidth="",e.style.maxHeight="";const p=i[c.offsetOpt]||0,m=parseInt(u[f.marginBefore],10),h=parseInt(u[f.marginAfter],10),b=m+h,_=o[f.after]-o[f.before]-b,y=parseInt(u[f.maxSize],10);(!y||_<y)&&(e.style[f.maxSize]=kt(_));const A=parseInt(u[c.marginBefore],10)+parseInt(u[c.marginAfter],10),I=r[c.before]-o[c.before]-A,O=o[c.after]-r[c.after]-A-p;(s===c.before&&e[c.offsetSize]>I||s===c.after&&e[c.offsetSize]>O)&&(s=I>O?c.before:c.after);const w=s===c.before?I:O,x=parseInt(u[c.maxSize],10);(!x||w<x)&&(e.style[c.maxSize]=kt(w));const E=window[c.scrollOffset],F=N=>Math.max(o[c.before],Math.min(N,o[c.after]-e[c.offsetSize]-A)),R=N=>Math.max(o[f.before],Math.min(N,o[f.after]-e[f.offsetSize]-b));s===c.before?(e.style[c.before]=E+F(r[c.before]-e[c.offsetSize]-A)-p+"px",e.style[c.after]="auto"):(e.style[c.before]=kt(E+F(r[c.after])+p),e.style[c.after]="auto");const U=window[f.scrollOffset];return e.style[f.before]=kt(U+R(r[f.before]-m)),e.style[f.after]="auto",e.dataset.side=s,{side:s,anchorRect:r,boundRect:o}}function lt(e,t){return typeof e=="object"?e[t]:e}function au(e){const t=document.createElement("span");return t.innerText=e,t.innerHTML}function cu(e,t,s){const i=e.slice(0,lt(t.maxLines,s));return i.map(({value:n,name:r="unnamed",color:o,active:u,transformed:c,seriesIdx:f},p)=>{const m=`
<span class="yagr-tooltip__val">${n}</span>
    ${typeof c=="number"?`<span class="yagr-tooltip__tf">${c.toFixed(2)}</span>`:""}
`;return`
<div class="yagr-tooltip__item ${u?"_active":""}" data-series="${f}">
    ${t.showIndicies?`<span class="yagr-tooltip__idx">${e.length-p}</span>`:""}
    <span class="yagr-tooltip__mark" style="background-color: ${o}"></span>${au(r)}&nbsp;&nbsp;${m}
</div>`}).join("")+(e.length>i.length?`<div class="yagr-tooltip__item _more">+${e.length-i.length}</div>`:"")}function hn(e){if(e.scales.length===0)return e.yagr.utils.i18n("nodata");const[t,s]=e.options.title?typeof e.options.title=="string"?[e.options.title,!1]:["",!0]:["",!1],i=e.scales.map(n=>{const r=lt(e.options.title,n.scale),o=e.scales.length>1?e.options.scales?`${lt(e.options.scales,n.scale)||""}`:`${e.yagr.utils.i18n("scale")}: ${n.scale}`:"";return`
<div class="__section" data-scale=${n.scale}>
    ${s&&r?`<div class="_section_title">${r}</div>`:""}
    ${o?`<div class="__section_scale">${o}</div>`:""}
    <div class="__section_body">${cu(n.rows,e.options,n.scale)}</div>
    ${lt(e.options.sum,n.scale)?`
        <div class="__section_sum">
            ${e.yagr.utils.i18n("sum")}: ${n.sum}
        </div>
    `:""}
</div>`});return`${t?`<div class="__title">${t}</div>`:""}${i.join("")}`}var uu=(e,t,s,i,n)=>{const r=Array.isArray(s.$c)?s.$c:t;let o=r[i];if(n&&o===n.value){const u=n.snapToValues??"closest",c=Qs(r,s,i,u,n.value);o=r[c]}else if(o===null){const u=e.snapToValues??"closest",c=s.snapToValues??u,f=Qs(r,s,i,c,null);o=r[f]}return o},pn={maxLines:gl,highlight:!0,sum:!1,render:hn,pinable:!0,strategy:"pin",sort:void 0,showIndicies:!1,hideNoData:!1,className:"yagr-tooltip_default",xOffset:dl,yOffset:pl,virtual:!1,showEmpty:!1,onUpdate:"reset"},fu=class{constructor(e,t={}){this.handlers={init:[],mount:[],show:[],pin:[],unpin:[],hide:[],render:[],destroy:[],reset:[]},this.placement=ou,this.renderTooltipCloses=()=>{},this.skipNextMouseUp=!1,this.emit=(s,i)=>{this.handlers[s].forEach(n=>{n(this.tOverlay,{state:this.state,actions:{pin:this.pin,show:this.show,hide:this.hide,dispose:this.dispose,reset:this.reset},data:i,yagr:this.yagr,event:s})})},this.reset=()=>{if(this.opts.onUpdate==="none"){this.yagr.plugins.cursor?.pin(!1);return}this.state.visible&&this.hide(),this.state.pinned&&this.pin(!1),this.emit("reset")},this.show=()=>{const s=!this.state.visible;this.state.visible=!0,this.tOverlay.style.display="block",s&&this.emit("show")},this.hide=()=>{const s=this.state.visible;this.state.visible=!1,this.tOverlay.style.display="none",this.emit("hide"),s&&this.emit("show")},this.pin=(s,i)=>{this.state.pinned=s;const n=this.state.range||[];if(this.yagr.plugins.cursor?.pin(s&&(n[1]===null||n.length<2)),this.opts.virtual)return this.emit(s?"pin":"unpin");i&&this.placement(this.tOverlay,{left:i.x+this.bLeft,top:this.bTop+i.y-(this.opts.yOffset||0)},"right",{bound:this.bound,xOffset:this.opts.xOffset,yOffset:this.opts.yOffset});const r=this.tOverlay.querySelector("._tooltip-list");s?(this.state.visible||this.show(),this.tOverlay.classList.add("yagr-tooltip_pinned"),r&&r?.clientHeight&&(r.style.height=kt(r.clientHeight)),this.opts.render===hn&&(document.addEventListener("mousemove",this.checkFocus),document.addEventListener("mousedown",this.detectClickOutside))):(this.tOverlay.classList.remove("yagr-tooltip_pinned"),this.opts.render===hn&&(document.removeEventListener("mousemove",this.checkFocus),document.removeEventListener("mousedown",this.detectClickOutside))),this.emit(s?"pin":"unpin")},this.checkFocus=s=>{const i=s.target;let n;i&&this.tOverlay.contains(i)&&i.classList.contains("yagr-tooltip__item")&&(n=i.dataset.series);const r=n?this.yagr.uplot.series[Number(n)]:null;n&&r?(this.state.focusedSeries=n,this.yagr.setFocus(r.id,!0)):this.state.focusedSeries&&(this.state.focusedSeries=null,this.yagr.setFocus(null,!0))},this.render=s=>{const i=this.yagr.uplot;let{left:n,top:r}=s;const{idx:o}=s,{opts:u,state:c}=this;if(u.show&&typeof u.show=="function"&&u.show(this.yagr)===!1){this.hide();return}(n<0||r<0)&&!c.pinned&&this.isNotInDrag&&this.hide(),r=wl(r,0,i.bbox.top+i.bbox.height),n=wl(n,0,i.bbox.left+i.bbox.width);const{data:f}=i;if(f===null||Ht(o)||r===void 0)return;const p=f[0][o],m={},h={},b={};let _=i.series.length-1;for(;_>=1;){const w=i.series[_];if(!w.show){_-=1;continue}const x=w.scale||ht;b[x]=b[x]||[],b[x].push(_),_-=1}if(Object.entries(b).forEach(([w,x])=>{h[w]=h[w]||{rows:[]};const E=h[w],F=Number(i.posToVal(r,w).toFixed(2)),R=lt(u.value,w);for(const N of x){const P=i.data[N],L=i.series[N];let H=uu(this.yagr.config.cursor,P,L,o,this.interpolation),X=H;typeof H=="string"&&(X=H,H=null),lt(u.sum,w)&&(m[w]=m[w]||0,m[w]+=H||0);const K=P[o],Y=L.$c&&L.$c[o]===this.stripValue?H:K;if(H===null&&u.hideNoData||L.showInTooltip===!1)continue;const ae=L.precision??lt(u.precision,w),W=L.formatter?L.formatter(X,L):R(X,ae),Ce={id:L.id,name:L.name,dataValue:L.$c[o],originalValue:H,value:W,y:Y,displayY:K,color:L.color,seriesIdx:N,rowIdx:E.rows.length?E.rows[E.rows.length-1].rowIdx+1:0};L.normalizedData&&(Ce.transformed=L.normalizedData[o]),L._transformed&&(Ce.transformed=P[o]),!(u.omitBy&&u.omitBy(Ce))&&E.rows.push(Ce)}if(lt(u.highlight,w)&&E.rows.length){const N=lt(u.tracking,w);let P=0;N==="area"?P=jo(E,F,lt(u.stickToRanges,w)):N==="sticky"?P=Ko(E,F):typeof N=="function"&&(P=N(E,F,{x:i.posToVal(n,"x"),y:i.posToVal(r,w),idx:o,scale:w,series:this.yagr.series,serieIndicies:x,interpolation:this.interpolation})),P!==null&&(E.rows[P].active=!0)}const U=lt(u.sort,w);U&&E.rows.sort(U)}),Object.values(h).some(({rows:w})=>w.length>0)||u.showEmpty)this.onMouseEnter();else{this.hide();return}const I=this.over.getBoundingClientRect();this.bLeft=I.left,this.bTop=I.top,this.bWidth=I.width;const O={left:n+this.bLeft,top:this.bTop+r-(u.yOffset||0)};this.renderTooltipCloses=()=>{const w={scales:Object.entries(h).map(([E,F])=>({scale:E,rows:F.rows,sum:m[E]})),options:u,x:p};if(!Object.values(h).some(({rows:E})=>E.filter(({id:F})=>this.yagr.getSeriesById(F)?.show).length>0)&&!u.showEmpty){this.hide();return}u.virtual||(this.tOverlay.innerHTML=u.render({...w,state:c,yagr:this.yagr,defaultRender:pn.render}),this.placement(this.tOverlay,O,"right",{bound:this.bound,xOffset:u.xOffset,yOffset:u.yOffset})),this.emit("render",{...w,anchor:O})},!c.pinned&&this.renderTooltipCloses()},this.initWithUplot=s=>{this.over=s.root.querySelector(".u-over"),this.over.addEventListener("mousedown",this.onMouseDown),this.over.addEventListener("mousemove",this.onMouseMove),this.over.addEventListener("mouseenter",this.onMouseEnter),this.over.addEventListener("mouseleave",this.onMouseLeave),document.addEventListener("mouseup",this.onMouseUp)},this.setSize=()=>{const s=this.over.getBoundingClientRect();this.bLeft=s.left,this.bTop=s.top},this.dispose=()=>{this.over.removeEventListener("mousedown",this.onMouseDown),this.over.removeEventListener("mousemove",this.onMouseMove),this.over.removeEventListener("mouseenter",this.onMouseEnter),this.over.removeEventListener("mouseleave",this.onMouseLeave),document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.checkFocus),document.removeEventListener("mousedown",this.detectClickOutside),this.tOverlay.remove(),this.state.mounted=!1,this.emit("destroy")},this.updateOptions=s=>{Object.assign(this.opts,s),this.tOverlay.className=`yagr-tooltip ${this.opts.className||""}`},this.on=(s,i)=>{this.handlers[s].push(i)},this.off=(s,i)=>{this.handlers[s]=this.handlers[s].filter(n=>n!==i)},this.detectClickOutside=s=>{const i=s.target;if(i instanceof Element){const n=i&&this.tOverlay.contains(i),r=i&&this.over.contains(i);!n&&!r&&(this.pin(!1),this.hide())}},this.onMouseDown=s=>{this.state.range=[this.getCursorPosition(),null],this.state.pinned&&(this.pin(!1),this.hide(),this.render({left:s.clientX-this.bLeft,top:s.clientY-this.bTop,idx:this.yagr.uplot.posToIdx(s.clientX-this.bLeft)}),this.skipNextMouseUp=!0)},this.onMouseMove=()=>{this.state.range?.length&&(this.state.range[1]=this.getCursorPosition())},this.setCursorLeaved=s=>{const i=this.over.getBoundingClientRect(),n=s.clientX,r=this.state.range,o=r[0],c=n-i.left>o.clientX,f=this.yagr.config.timeline;let p;c?(r[1]={clientX:this.bWidth,value:this.yagr.uplot.posToVal(this.bWidth,"x"),idx:f.length-1},p=r[1]):(r[1]=r[0],r[0]={clientX:0,value:this.yagr.uplot.posToVal(0,"x"),idx:0},p=r[0]),this.yagr.uplot.setCursor({left:p.clientX,top:s.clientY-i.top})},this.onMouseUp=s=>{if(this.state.range===null)return;const[i]=this.state.range||[];let n;if(s.target===this.over?n=this.getCursorPosition():n=this.state.range[1],this.opts.strategy==="none")return;const r=i&&i.clientX===n?.clientX,o=i&&i.clientX!==n?.clientX,u=this.opts.strategy;(r&&!this.skipNextMouseUp&&u!=="drag"||o&&(u==="all"||u==="drag"))&&(this.pin(!this.state.pinned),this.show(),this.renderTooltipCloses()),this.state.range=null,this.skipNextMouseUp=!1},this.onMouseEnter=()=>{this.show()},this.onMouseLeave=s=>{const i=this.state.pinned;this.state.range?.[0]&&this.setCursorLeaved(s),!i&&this.isNotInDrag&&this.hide()},this.defaultTooltipValueFormatter=(s,i)=>{const n=this.yagr.config.processing||{};return typeof s=="string"?n.nullValues&&n.nullValues.hasOwnProperty(s)?n.nullValues[s]:"-":typeof s=="number"?s.toFixed(typeof i=="number"?i:typeof this.opts.precision=="number"?this.opts.precision:2):"-"},this.getCursorPosition=()=>{const s=this.yagr.uplot.cursor.left;return s===void 0?null:{clientX:s,value:this.yagr.uplot.posToVal(s,"x"),idx:this.yagr.uplot.posToIdx(s)}},this.yagr=e,this.over=e?.uplot?.over,this.opts={...pn,strategy:t.pinable?"pin":pn.strategy,tracking:e.config.chart.series?.type==="area"?"area":"sticky",value:this.defaultTooltipValueFormatter,...t},this.bound=this.opts.boundClassName&&document.querySelector(this.opts.boundClassName)||document.body,this.renderNode=this.opts.renderClassName&&document.querySelector(this.opts.renderClassName)||document.body,this.tOverlay=document.createElement("div"),this.tOverlay.id=`${e.id}_tooltip`,this.tOverlay.className=`yagr-tooltip ${this.opts.className||""}`,this.tOverlay.style.display="none",this.state={mounted:!1,pinned:!1,visible:!1,range:null,focusedSeries:null},this.bLeft=0,this.bTop=0,this.bWidth=0,this.opts.virtual?this.placement=()=>{}:(this.renderNode.appendChild(this.tOverlay),this.state.mounted=!0,this.emit("mount"))}get interpolation(){return this.yagr.config.processing?.interpolation}get stripValue(){return this.interpolation?this.interpolation.value:void 0}get isNotInDrag(){return this.opts.strategy==="none"||this.opts.strategy==="pin"?!0:!this.state.range?.[1]}};function hu(e,t={}){const s=new fu(e,t),i=()=>({hooks:{init:o=>{s.initWithUplot(o)},setSize:()=>{s.setSize()},setCursor:o=>{s.render(o.cursor)}}}),n=i();function r(o){const u=i();s.reset(),o.hooks.init.push(u.hooks.init),o.hooks.setSize.push(u.hooks.setSize),o.hooks.setCursor.push(u.hooks.setCursor)}return{state:s.state,pin:s.pin,show:s.show,hide:s.hide,uplot:n,display:s.render,updateOptions:s.updateOptions,on:s.on,off:s.off,tooltip:s,dispose:s.dispose,reInit:r,reset:s.reset}}var pu=hu,Zr=(e,t,s,i,n,r,o,u)=>{const{ctx:c}=e,f=Math.round(e.valToPos(t,Te,!0)),p=Math.round(e.valToPos(s,u||ht,!0));if(c.beginPath(),c.arc(f,p,i*2,0,2*Math.PI),c.fillStyle=r,n){const m=c.lineWidth,h=c.strokeStyle;c.lineWidth=n,c.strokeStyle=o,c.stroke(),c.lineWidth=m,c.strokeStyle=h}c.fill(),c.closePath()};function Jr(e,t,s,i){const{color:n,scale:r,spanGaps:o,count:u,pointsSize:c}=e.series[t];if(o&&u>1)return!1;let f=s,p;for(;f<=i;){const m=e.data[t][f];if(m===null){p=m,f++;continue}const h=f+1,b=e.data[t][h];Ht(p)&&Ht(b)&&Zr(e,e.data[0][f],m,c??Ts/2,0,n,n,r||ht),p=m,f++}}function du(e,t){const{size:s=Ts,strokeWidth:i=2,strokeColor:n="#ffffff",show:r}=t.markers,u=t.chart?.series?.pointsSize||Ts;function c(p,m,h,b){const{scale:_,_focus:y,color:A,getFocusedColor:I,type:O}=p.series[m];let w=h;const x=O==="dots"?r?s:u:s;for(;w<=b;){const E=p.data[m][w];E!==null&&Zr(p,p.data[0][w],E,x,i,(y||y===null?A:I(e,m))||A,n,_||ht),w++}}const f=(p,m)=>{p===0||p===null||(m.type==="dots"||t.markers.show)&&(m.points=m.points||{},m.points.show=c)};return{opts:(p,m)=>{(t.markers.show||m.series.some(h=>h.type==="dots"))&&m.series.forEach((h,b)=>f(b,h))},hooks:{addSeries:(p,m)=>{const h=p.series[m];f(m,h)},setSeries:(p,m,h)=>{f(m,h)}}}}function gu(e,t,s,i){const n=e.series[t],{type:r,interpolation:o}=n;let u;switch(r){case"column":{u=ee.paths.bars&&ee.paths.bars({size:[sl,il],...e.series[t].renderOptions||{}});break}case"dots":{u=()=>null;break}case"line":case"area":default:switch(o){case"smooth":u=ee.paths.spline&&ee.paths.spline();break;case"left":u=ee.paths.stepped&&ee.paths.stepped({align:1});break;case"right":{u=ee.paths.stepped&&ee.paths.stepped({align:-1});break}case"linear":default:u=ee.paths.linear&&ee.paths.linear();break}}return u?u(e,t,s,i):null}function pt(e,t,s,i){if(e[s]!==void 0)return e[s];const n=t.config.chart.series;return n&&s in n?n[s]:i}function dn(e,t,s){const i=pt(t,e,"type","line"),n={...t,type:i,show:t.show??!0,name:t.name||`${e.utils.i18n("series")} ${s+1}`,color:t.color?e.utils.colors.parse(t.color):e.utils.theme.DEFAULT_LINE_COLOR,id:(t.id===void 0?t.name:String(t.id))||_l(),$c:t.data,scale:t.scale||ht,count:0,sum:0,avg:0,getFocusedColor:Yo};n.points=n.points||{};const r=ml(e,"color");return n.type==="area"&&(n.lineColor=e.utils.colors.parse(pt(t,e,"lineColor",al)),n.lineWidth=pt(t,e,"lineWidth",cl),n.fill=r,n.stroke=ml(e,"lineColor"),n.width=n.lineWidth,n.points.show=Jr,n.interpolation=pt(t,e,"interpolation","linear"),n.spanGaps=pt(t,e,"spanGaps",!1)),n.type==="line"&&(n.width=pt(t,e,"width",Ci),n.width=n.width||Ci,n.stroke=r,n.points.show=Jr,n.interpolation=pt(t,e,"interpolation","linear"),n.spanGaps=pt(t,e,"spanGaps",!1)),n.type==="column"&&(n.stroke=r,n.fill=r,n.points.show=!1,n.width=n.width??0,n.renderOptions=pt(n,e,"renderOptions")),n.type==="dots"&&(n.stroke=()=>n.color,n.fill=r,n.width=2,n.pointsSize=pt(n,e,"pointsSize",Ts)),n.paths=gu,n}var Qr=(e,t)=>{e.$c=t.$c??e.$c,e.show=t.show??e.show,e.data=t.data??e.data,e.width=t.width??e.width,e.pointsSize=t.pointsSize??e.pointsSize,e.color=t.color??e.color,e.lineColor=t.lineColor??e.lineColor,e.lineWidth=t.lineWidth??e.lineWidth,e.stroke=t.stroke??e.stroke,e.getFocusedColor=t.getFocusedColor??e.getFocusedColor,e.formatter=t.formatter??e.formatter,e.paths=t.paths??e.paths},gs={Series:"series",Axes:"axes"},mu={Distr:{Linear:1,Ordinal:2,Logarithmic:3,ArcSinh:4}},jt={Side:{Top:0,Right:1,Bottom:2,Left:3},Align:{Right:0,Left:1}},eo=(e,t)=>{const s=e.range;if(typeof s=="function")return(n,r,o)=>s(n,r,o,t);if(e.normalize)return[0,e.normalizeBase||100];if(e.range==="auto")return;let i;switch(e.range){case void 0:case"nice":{i=_u;break}case"offset":{i=vu;break}default:throw new Error(`Unknown scale range type ${e.range}`)}return(n,r,o)=>{let{min:u,max:c}=i(r,o,e,t);const f=e.minRange||Hn;if(Math.abs(c-u)<f&&(u>=0?c+=f:(c+=f/2,u-=f/2)),u=typeof e.min=="number"?e.min:u,c=typeof e.max=="number"?e.max:c,e.type==="logarithmic"){const p=typeof e.min=="number";u<=0?u=Ri:p||(u=Math.min(u,Ri))}return(u>=c||c<=u)&&(typeof e.max=="number"?u=c-(mi(c-c*.1,!1)||1):c=u+(mi(u+u*.1,!1)||1)),[u,c]}};function vu(e,t,s){const i=e>=0&&s.stacking,n=t<=0&&s.stacking;return{min:i?0:Math.round(e-Math.abs(e)*(s.offset||Mi)),max:n?0:Math.round(t+Math.abs(t)*(s.offset||Mi))}}function _u(e,t,s){const i=e>=0&&s.stacking,r=t<=0&&s.stacking?0:typeof s.max=="number"?s.max:t,o=i?0:typeof s.min=="number"?s.min:e;if(o===r)return o>=0?{min:o,max:o+2}:{min:o-1,max:o+1};const u=r-o,c=mi(u,!1),f=mi(c/(Vn-1),!0);let p=Math.ceil(r/f)*f;p=isNaN(p)?100:p;let m=(i?Math.min(0,o):Math.floor(o/f)*f)||0;return m===p&&(m-=1,p+=1),{min:m,max:p}}function mi(e,t){const s=Math.floor(Math.log10(e)),i=e/10**s;return(t?i<1.5?1:i<3?2:i<7?5:10:i<=1?1:i<=2?2:i<=5?5:10)*10**s}function Su(e,t,s){const i=s.scales?{...s.scales}:{};return Object.keys(s.scales).length||(i.y={}),Object.entries(i).forEach(([n,r])=>{t[n]=t[n]||{};const o=t[n];if(n===Te)return;const u=typeof r.min=="number"?r.min:null,c=typeof r.max=="number"?r.max:null;if(c!==null&&u!==null){if(c<=u)throw new Error("Invalid scale config. .max should be > .min");o.range=[u,c]}const f=r.type==="logarithmic";if(f){o.distr=mu.Distr.Logarithmic,o.range=eo(r,s);return}if(e.isEmpty){o.range=[u===null?f?1:0:u,c===null?100:c];return}o.range=eo(r,s)}),t.x||(t.x={time:!0}),t}var yu={right:jt.Side.Right,top:jt.Side.Top,bottom:jt.Side.Bottom,left:jt.Side.Left},wu={left:jt.Align.Right,right:jt.Align.Left,top:void 0,bottom:void 0},bu=(e,t)=>({side:e?yu[e]:jt.Side.Left,align:t||(e?wu[e]:void 0)}),to=(e,t="")=>s=>{if(Ht(s))return t;if(s===0)return"0";const i=Math.abs(s),n=e==="auto"?2:e,[r,o]=qo(i),u=s/r;return(e==="auto"?String(u).replace(/\.(\d{5,})/,c=>c.slice(0,6)):Zo(u,n))+o},Eu=e=>{const t=e.precision,s=to(typeof t=="number"?t:t||"auto","");return function(n,r){return r.map(s)}},Tu=ee.fmtDate("{DD}.{MM}.{YYYY}"),Au=ee.fmtDate("{HH}:{mm}:{ss}"),Lu=ee.fmtDate("{mm}:{ss}"),Iu=ee.fmtDate("{mm}:{ss}.{fff}"),ku=ee.fmtDate("{YYYY}");function so(e,t){let s=Tu;const i=Math.ceil(e/t);return i<=yt?s=Iu:i<=Nt?s=Lu:i<=Ke?s=Au:i>=zt&&(s=ku),n=>s(new Date(n))}var xu=e=>{const t=e.chart.timeMultiplier||As;return(s,i)=>{const r=(i[i.length-1]-i[0])/t,o=so(r,i.length);return i.map(u=>o(u/t))}};function Du(e){return(t,s,i,n)=>{if(e<=2)return[i,n];const o=Math.abs(n-i)/(e-1);let u=o;const c=[];for(;i+u<n;)c.push(i+u),u+=o;return[i,...c,n]}}function vi(e,t){const s=t.utils.theme,i=t.config,n={splits:e.splitsCount?Du(e.splitsCount):e.splits,show:typeof e.show>"u"?!0:e.show,label:e.label||void 0,labelSize:e.labelSize||Zn,labelFont:e.labelFont||Pi,font:e.font||Fi,stroke:e.stroke||(()=>s.AXIS_STROKE),ticks:e.ticks?{...s.Y_AXIS_TICKS,...e.ticks}:s.Y_AXIS_TICKS,grid:i.grid||e.grid||s.GRID};return e.scale===Te?Object.assign(n,{getFormatter:so,gap:e.gap??Jn,size:yl(e.size)||(()=>Qn),values:e.values||xu(i),ticks:e.ticks?{...s.X_AXIS_TICKS,...e.ticks}:s.X_AXIS_TICKS,scale:Te,space:e.space||(()=>el),incrs:e.incrs||(()=>tl.map(r=>r*(i.chart.timeMultiplier||As))),side:2,stroke:e.stroke||(()=>s.AXIS_STROKE)}):(Object.assign(n,{gap:e.gap??Yn,size:yl(e.size)||qn,values:e.values||Eu(e),scale:e.scale||ht,getFormatter:()=>to(typeof e.precision=="number"?e.precision:e.precision||"auto",""),...bu(e.side||"left",e.align)}),e.space&&(n.space=e.space),n)}function Ou(e){const t=[!1,!0];return Object.values(e).forEach(s=>{["align","side","size","label","labelFont","labelGap","labelSize"].some(n=>s[n]!==void 0)&&(t[1]=!0)}),t}function io(e){let t,s;return e=e.replace(/(\d+)px/,(i,n)=>kt(t=Math.round((s=Number(n))*window.devicePixelRatio))),[e,t,s]}function no(e,t,s){const i=vi({...s,font:t.font},e);i.ticks={...t.ticks,...i.ticks},i.grid={...t.grid,...i.grid},i.border={...t.border,...i.border},i.splits=i.splits||t.splits,s.font&&s.font!==t.font?.[0]&&(i.font=io(s.font)),s.labelFont&&s.labelFont!==t.labelFont?.[0]&&(i.labelFont=io(s.labelFont)),Object.assign(t,i),e.plugins.plotLines?.update(s.plotLines,s.scale)}function Mu(e,t){const s=[];Object.entries(t.axes).forEach(([r,o])=>{s.push(vi({...o,scale:r},e))});const i=Te,n=ht;return t.axes[i]||s.push(vi({scale:i},e)),s.find(({scale:r})=>r!==i)||s.push(vi({scale:n},e)),s}function Ru(e){let t=!1,s=!1;return e.axes?e.axes.forEach(i=>{i.scale!==Te&&((i.side===void 0||i.side===3)&&(t=!0),i.side===1&&(s=!0))}):t=!0,t&&!s?nl:s&&!t?ll:rl}var Pu=0,Fu={[gs.Series]:0,[gs.Axes]:1,plotLines:2};function gn(e,t){return e.some(s=>Ls(s,t))}var Cu={"012":"draw",102:"draw",201:"drawClear",210:"drawClear",120:"drawAxes","021":"drawSeries"};function Nu(e){let t=[];return function(s){const i=s.config.chart.appearance?.drawOrder,n=(i?i.map(f=>Fu[f]):[0,1,2]).join(""),r=Cu[n]||"drawClear";function o(f){const{ctx:p}=f,{height:m,top:h,width:b,left:_}=f.bbox,y=f.data[0];for(const A of t){if(!A.scale)continue;if(e.render){e.render(f,A);continue}p.save(),p.fillStyle=s.utils.colors.parse(A.color);const{scale:I,value:O}=A;if(Array.isArray(O)){const[w,x]=O.map(U=>{if(Math.abs(U)!==1/0){if(I===Te){if(U<y[0])return y[0];if(U>y[y.length-1])return y[y.length-1]}else{const P=f.scales[I];if(P.min!==void 0&&U<P.min)return P.min;if(P.max!==void 0&&U>P.max)return P.max}return U}const N=U>0?I===Te?f.width:0:I===Te?0:f.height;return f.posToVal(N,I)}),E=f.valToPos(w,I,!0),F=f.valToPos(x,I,!0),R=A.accent;I===Te?(p.fillRect(E,h,F-E,m),R&&(p.fillStyle=R.color,p.fillRect(E,h-R.space,F-E,R.space))):(p.fillRect(_,E,b,F-E),R&&(p.fillStyle=R.color,p.fillRect(b+_,E,R.space,F-E)))}else{const w=f.valToPos(O,I,!0),x=A;if(p.beginPath(),I===Te){const E=f.data[0][f.data[0].length-1],F=f.valToPos(E,I,!0);if(w-F>Pu)continue;p.moveTo(w,h),p.lineTo(w,m+h)}else p.moveTo(_,w),p.lineTo(b+_,w);p.lineWidth=x.width||Qe,p.strokeStyle=x.color||"#000",x.dash&&p.setLineDash(x.dash),p.closePath(),p.stroke()}p.restore()}}const u=r==="drawSeries"?(f,p)=>{p===f.series.length-1&&o(f)}:o,c={get:()=>t,clear:f=>{t=f?t.filter(p=>p.scale!==f):[]},remove:f=>{t=t.filter(p=>!gn(f,p))},add:(f,p)=>{for(const m of f)t.push(p?{scale:p,...m}:m)},update:(f,p)=>{if(!f||f.length===0){c.clear(p);return}const m=f.filter(b=>!gn(t,b)),h=t.filter(b=>!gn(f,b));m.length&&c.add(m,p),h.length&&c.remove(h)},uplot:{opts:()=>{const f=s.config;t=[],Object.entries(f.axes).forEach(([p,m])=>{m.plotLines&&m.plotLines.forEach(h=>{t.push({...h,scale:p})})})},hooks:{[r]:u}}};return c}}function _i(e,t){for(const s of e||[])if(s===t)return;e?.push(t)}var zu=class{initMixin(){this._uHooks.onDraw=()=>{if(this.state.stage==="listen")return;this.state.stage="listen",this.execHooks("stage",{chart:this,stage:this.state.stage});const e=performance.now()-this._startTime;this._meta.renderTime=e,this.execHooks("load",{chart:this,meta:this._meta})},this._uHooks.ready=()=>{const e=performance.now()-this._startTime;this._meta.initTime=e,this.execHooks("inited",{chart:this,meta:{initTime:e}})},this._uHooks.drawClear=e=>{const{ctx:t}=e;t.save(),t.fillStyle=this.utils.theme.BACKGROUND,t.fillRect(Qe,Qe,e.width*Qe-2*Qe,e.height*Qe-2*Qe),t.restore()},this._uHooks.setSelect=e=>{const{left:t,width:s}=e.select,[i,n]=[e.posToVal(t,Te),e.posToVal(t+s,Te)],{timeMultiplier:r=As}=this.config.chart||{};this.execHooks("onSelect",{from:Math.ceil(i/r),to:Math.ceil(n/r),chart:this}),e.setSelect({width:0,height:0,top:0,left:0},!1)}}createUplotOptions(e=!1){const{config:t}=this,s=[];let i=this.plugins?.tooltip;if(t.tooltip&&t.tooltip.show!==!1&&(i?i.updateOptions(t.tooltip):i=pu(this,t.tooltip),s.push(i.uplot),this.plugins.tooltip=i),e)this.plugins.plotLines&&s.push(this.plugins.plotLines.uplot);else{const p=Nu(this.config.plotLines||{})(this);this.plugins.plotLines=p,s.push(p.uplot)}Object.entries(t.plugins).forEach(([p,m])=>{const h=m(this);s.push(h.uplot),Object.assign(this.plugins,{[p]:h})});const n=t.chart,r={width:this.root.clientWidth,height:this.clientHeight,title:t.title?.text,plugins:s,focus:{alpha:zn},series:[{id:Oi,$c:t.timeline,scale:Te,count:t.timeline.length}],ms:n.timeMultiplier||As,hooks:t.hooks||{}};if(this.state.isEmptyDataSet=t.timeline.length===0||t.series.length===0||t.series.every(({data:p})=>p.length===0),r.cursor=r.cursor||{},r.cursor.points=r.cursor.points||{},r.cursor.drag=r.cursor.drag||{dist:n.select?.minWidth||fl,x:r.cursor.y??!0,y:r.cursor.y??!1,setScale:n.select?.zoom??!0},this.utils.sync&&(r.cursor.sync=r.cursor.sync||{key:this.utils.sync.key}),t.cursor){const p=sa(this,t.cursor);this.plugins.cursor=p,s.push(p.uplot)}const o=t.series||[],u=r.series;for(let p=o.length-1;p>=0;p--){const m=dn(this,o[p]||{},p),h=u.push(m);this.state.y2uIdx[m.id||p]=h-1}const c=du(this,t);return s.push(c),r.series=u,(!t.scales||Object.keys(t.scales).length===0)&&(t.scales={x:{},y:{}}),r.scales=r.scales||{},r.scales=Su(this,r.scales,t),r.axes=r.axes||[],r.axes.push(...Mu(this,t)),r.hooks=t.hooks||{},r.hooks.draw=r.hooks.draw||[],r.hooks.ready=r.hooks.ready||[],r.hooks.drawClear=r.hooks.drawClear||[],r.hooks.setSelect=r.hooks.setSelect||[],_i(r.hooks.draw,this._uHooks.onDraw),_i(r.hooks.ready,this._uHooks.ready),_i(r.hooks.drawClear,this._uHooks.drawClear),_i(r.hooks.setSelect,this._uHooks.setSelect),r.drawOrder=n.appearance?.drawOrder?n.appearance?.drawOrder.filter(p=>p===gs.Series||p===gs.Axes):[gs.Series,gs.Axes],r.legend={show:!1},r.padding=t.chart.size?.padding||Ru(r),this.plugins.legend?.preInit(this,this.config.legend,r),r.height=this.clientHeight,this.options=r,r}},Vu=class{transformSeries(){const e=performance.now(),t=[],s=this.config,i=s.timeline;let n=s.processing||!1,r=this.config.series.map(({data:f})=>f);n&&n.interpolation&&(r=Jo(r,i,n),n=!1);const o=!!(n&&n.nullValues),u=n&&n.nullValues||{},c={};for(let f=0;f<r.length;f++){let p=[];const m=f+1,h=r[f],b=this.options.series.length-m,_=this.options.series[b],y=_.scale||ht,A=this.config.scales[y]||{},I=A.stacking,O=_.stackGroup||0;let w=!0;I&&!c[y]&&(this.options.focus=this.options.focus||{alpha:1.1},this.options.focus.alpha=1.1,c[y]=[]),I&&!c[y][O]&&(c[y][O]=new Array(i.length).fill(0)),_.count=0;for(let x=0;x<h.length;x++){let E=h[x];if(o&&u[String(E)]&&(E=null),_.transform&&(_._transformed=!0,E=_.transform(E,r,x)),A.transform&&(_._transformed=!0,E=A.transform(E,r,x)),E===null)if(_.type==="line"||_.type==="dots"){p.push(null);continue}else E=I?0:null;if(w=!1,A.normalize){const R=Xo(this.options.series,x,y);E=R&&(E??0)/R*(A.normalizeBase||100),_.normalizedData=_.normalizedData||[],_.normalizedData[x]=E}A.stacking&&(_.show===!1&&(E=0),E=c[y][O][x]+=E??0),A.type==="logarithmic"&&E===0&&(E=1),_.sum=(_.sum||0)+(E||0),typeof _.$c[x]=="number"&&(_.count+=1),p.push(E)}_.avg=(_.sum||0)/_.count,_.empty=w,_.postProcess&&(p=_.postProcess(p,f,this)),t.unshift(p)}return t.unshift(this.config.timeline),this.series=t,this.execHooks("processed",{chart:this,meta:{processTime:performance.now()-e}}),this.series}};function Hu(e,t,s){e.utils.i18n=Kr(s),t.redrawLegend=!0}function Uu(e,t,s){e.utils.theme.setTheme(t);const n=["light","light-hc","dark","dark-hc"].map(r=>`yagr_theme_${r}`);e.root.classList.remove(...n),e.root.classList.add("yagr_theme_"+t),s.redraw=[!1,!0]}function Bu(e,t,s){const{x:i,...n}=s;if(i){const r=e.uplot.axes.find(({scale:o})=>o===Te);r&&no(e,r,{scale:Te,...i})}Object.entries(n).forEach(([r,o])=>{const u=e.uplot.axes.find(({scale:c})=>c===r);u&&no(e,u,{scale:r,...o})}),t.redraw=Ou(s)}function Gu(e,t,s){const i=t===null?null:e.state.y2uIdx[t];e.plugins.cursor?.focus(i,s),e.uplot.setSeries(i,{focus:s})}function $u(e,t,s,i,n){const r=t===null?null:e.state.y2uIdx[t];(t===null?e.config.series:[e.config.series.find(({id:c})=>c===t)]).forEach(c=>{c&&(c.show=s)}),n.fns.push(()=>{e.uplot.setSeries(r,{show:s})}),e.options.series=e.uplot.series;let u=!1;if(r){const c=e.uplot.series[r];c.show=s;const f=c.scale||ht,p=e.config.scales[f];u=!!(p&&p.stacking)}else u=e.options.series.reduce((c,f)=>{const{scale:p}=f;return f.show=s,!!(p&&e.config.scales[p]?.stacking||c)},!1);u&&(n.recalc=!0,n.fns.push(()=>{e.uplot.setData(e.series,!0),i&&e.plugins.legend?.update()}))}function Wu(e,t,s){let i=!1,n=!1;Object.entries(t).forEach(([u,c])=>{const f=e.config.scales[u];if(f){const{stacking:p}=f,{stacking:m}=c;p!==m&&(i=!0),(c.normalize!==f.normalize||c.normalizeBase!==f.normalizeBase)&&(n=!0)}});const r=Object.entries(t).every(([u,c])=>{const f=e.config.scales[u],{min:p,max:m,...h}=f,{min:b,max:_,...y}=c;return!(Ls(y,h)===!1)&&(p!==b||m!==_)}),o=Object.keys(t).includes(Te);if(r&&!o)return Object.entries(t).forEach(([u,c])=>{s.fns.push(()=>{e.uplot.setScale(u,{min:c.min,max:c.max})})});(i||n)&&(s.reinit=!0),e.config.scales=t,s.reinit=!0}function Yu(e,t){return function(i,n){const r=Sl(e,i),o=Sl(t,i);return n?!n(r,o):r!==o}}function ju(e,t){if(e.length!==t?.length)return!0;const s=new Map,i=new Map;return e.forEach(n=>{s.set(n.id,n)}),t.forEach(n=>{i.set(n.id,n)}),!!(t.some(({id:n})=>!s.has(n))||e.some(({id:n})=>!i.has(n)))}function Xu(e,t,s,i=!1){if(i){e.config={...e.config,...s},t.reinit=!0;return}const n=Yu(e.config,s);s.title&&n("title")&&e.setTitle(s.title),s.chart?.appearance?.theme&&n("chart.appearance.theme")&&e.setTheme(s.chart?.appearance?.theme),s.chart?.appearance?.locale&&n("chart.appearance.locale")&&e.setLocale(s.chart?.appearance?.locale),s.axes&&n("axes",Ls)&&e.setAxes(s.axes),s.scales&&n("scales",Ls)&&e.setScales(s.scales),!!s.series&&ju(e.config.series,s.series)&&(t.redrawLegend=!0),(s.series||s.timeline)&&e.setSeries(s.timeline??e.config.timeline,s.series??e.config.series,{incremental:!1}),s.tooltip&&n("tooltip")&&e.plugins.tooltip?.updateOptions(s.tooltip),s.legend&&n("legend")&&(t.reinit=!0),e.plugins.tooltip?.reset(),t.reopt=!0,e.config={...e.config,...s}}function Ku(e,t,s,i={incremental:!0,splice:!1}){let n=[],r=[],o=null,u=!1,c=!1,f;if(["number","string"].includes(typeof t)?(u=!1,f=!1,r=[s],o=t):typeof t[0]=="number"?(n=t,r=s,u=!!i.incremental,f=!i.incremental):(r=t,f=!0),this.isEmpty&&r.some(({data:p})=>p?.length)){e.reinit=!0;return}if(f===!1){let p=!1;if(u&&this.config.timeline.push(...n),r.forEach(m=>{let h=typeof o=="number"?this.config.series[0]:this.config.series.find(({id:_})=>_===m.id||_===o),b=h?.id;if(typeof o=="number"&&this.state.y2uIdx[o]&&(h=this.config.series[o],b=o),h&&b){const{data:_,...y}=m,A=this.state.y2uIdx[b];(h.type==="dots"||m.type==="dots"||this.config.chart.series?.type==="dots")&&(e.reinit=!0),u?h.data=_?h.data.concat(_):h.data:_?.length&&(h.data=_,c=!0);const I=dn(this,Object.assign(h,y),A),O=this.options.series[A],w=this.uplot.series[A];w.show!==I.show&&e.fns.push(()=>{this.uplot.setSeries(A,{show:I.show})}),(w._focus===null||w._focus!==I.focus)&&e.fns.push(()=>{this.uplot.setSeries(A,{focus:I.focus})}),w.color!==I.color&&(p=!0),I.scale&&this.config.scales[I.scale]?.stacking&&(c=!0),Qr(O,I),Qr(w,I)}else e.fns.push(()=>{const _=dn(this,m,this.config.series.length);this.state.y2uIdx[_.id]=this.uplot.series.length,this.uplot.addSeries(_,this.config.series.length)}),this.config.series.push(m)}),p&&e.fns.push(()=>{this.plugins.cursor?.updatePoints()}),i.splice){const m=r[0].data.length;this.config.series.forEach(h=>{h.data.splice(0,m)}),this.config.timeline.splice(0,n.length)}}else this.config.timeline=n,this.config.series=r,e.reinit=!0;e.reinit||(this._batch.fns.push(()=>this.plugins?.tooltip?.reset()),(c||n.length)&&(e.recalc=!0,e.fns.push(()=>{this.uplot.setData(this.series)})))}var qu=class{setLocale(e){this.batch(t=>Hu(this,t,e))}setTitle(e){this.batch(t=>{this.config.title=e,this.initTitle(),t.redraw=[!0,!0]})}setTheme(e){this.batch(t=>Uu(this,e,t))}setAxes(e){this.batch(t=>Bu(this,t,e))}setSeries(e,t,s={incremental:!0,splice:!1}){this.batch(i=>Ku.call(this,i,e,t,s))}setFocus(e,t){this.batch(()=>Gu(this,e,t))}setVisible(e,t,s=!0){this.batch(i=>$u(this,e,t,s,i))}setScales(e){this.batch(t=>Wu(this,e,t))}setConfig(e,t=!1){this.batch(s=>Xu(this,s,e,t))}};function Zu(e,t){const s=[];t.forEach(i=>{Object.getOwnPropertyNames(i.prototype).forEach(n=>{Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(i.prototype,n)||Object.create(null))}),i.prototype.initMixin&&s.push(i.prototype.initMixin)}),e.prototype.initMixins=function(){s.forEach(i=>i.call(this))}}var Ju=class{initMixin(){this._batch={active:!1,fns:[]}}batch(e){if(this._batch.active)return e(this._batch);if(this._batch.active=!0,e(this._batch),this._batch.reinit)return this.fullUpdate();this._batch.redrawLegend&&this.plugins.legend?.redraw(),this._batch.reopt&&this.createUplotOptions(!0),this._batch.recalc&&this.inStage("processing",()=>{this.transformSeries()}).inStage("listen"),this._batch.fns.length&&this.uplot.batch(()=>this._batch.fns.forEach(t=>t(this._batch))),this._batch.redraw&&this.uplot&&this.redraw(...this._batch.redraw),this._batch={active:!1,fns:[]}}fullUpdate(){let e,t;this.inStage("dispose",()=>{if(this.uplot){const s=this.uplot.cursor;e=s.left,t=s.top,this.uplot.destroy()}this.plugins.legend?.destroy()}).inStage("config",()=>{this.plugins.legend=new Ll,this._batch={active:!1,fns:[]},this.createUplotOptions(!0),this.options=this.config.editUplotOptions?this.config.editUplotOptions(this.options):this.options}).inStage("processing",()=>{this.transformSeries()}).inStage("uplot",()=>{this.uplot=new ee(this.options,this.series,this.initRender),e&&t&&e>0&&t>0&&this.uplot.setCursor({left:e,top:t}),this.state.subscribed||this.unsubscribe()}).inStage("listen")}},lo=class{constructor(e,t){this.plugins={},this._meta={},this._uHooks={},this.init=()=>{this.config.chart.size?.adaptive&&!this.resizeOb&&(this.resizeOb=new ResizeObserver(Qo(this.onResize,this.config.chart.size.resizeDebounceMs||100)),this.resizeOb.observe(this.root)),this.config.hooks.dispose||(this.config.hooks.dispose=[]),this.unsubscribe(),this.config.hooks.dispose.push(this.trackMouse())},this.execHooks=(i,...n)=>{const r=this.config.hooks[i];if(Array.isArray(r))for(const o of r)o&&typeof o=="function"&&o(...n)},this.initRender=(i,n)=>{const r=this.config.legend?.position;this.root.firstChild?!r||r==="bottom"?this.root.insertBefore(i.root,this.root.firstChild):this.root.appendChild(i.root):!r||r==="bottom"?this.root.appendChild(i.root):this.root.insertBefore(i.root,this.root.firstChild),this.config.legend?.show&&(this.plugins.legend?.init(i),this.reflow(!1)),this.initTitle(),n()},this.onResize=i=>{const[n]=i;this._cache.height===n.contentRect.height&&this._cache.width===n.contentRect.width||(this.plugins.tooltip?.reset(),this.reflow(),this.execHooks("resize",{entries:i,chart:this}))},this.initMixins(),this._startTime=performance.now(),this.state={isEmptyDataSet:!1,isMouseOver:!1,stage:"config",y2uIdx:{},subscribed:!1};const s=Object.assign({title:{},data:[],axes:{},series:[],scales:{},hooks:{},settings:{},chart:{},cursor:{},plugins:{},legend:{show:!1},tooltip:{show:!0},grid:null,markers:{}},t);this.config=s,this.inStage("config",()=>{this.id=e.id||_l(),this.root=e,this.root.classList.add("yagr"),this.root.id||(this.root.id=this.id);const i=new Js,n=this.config.cursor.sync,r=this.config.chart;r.series||={type:"line"},r.size||={adaptive:!0},r.appearance||={locale:"en"},r.select||={},this.utils={colors:i,i18n:Kr(s.chart.appearance?.locale||"en"),theme:new hl(i)},i.setContext(e),n&&(this.utils.sync=ee.sync(typeof n=="string"?n:Un)),!r.size.adaptive&&r.size.width&&r.size.height&&(e.style.width=kt(r.size.width),e.style.height=kt(r.size.height)),this.plugins.legend=new Ll,this.setTheme(r.appearance.theme||"light"),this.createUplotOptions(),this._cache={height:this.options.height,width:this.options.width},s.editUplotOptions&&(this.options=s.editUplotOptions(this.options))}).inStage("processing",()=>{this.transformSeries()}).inStage("uplot",()=>{this.uplot=new ee(this.options,this.series,this.initRender),this.canvas=e.querySelector("canvas"),this.init();const i=performance.now()-this._startTime;this._meta.processTime=i}).inStage("render")}get isEmpty(){return this.state.isEmptyDataSet}redraw(e=!0,t=!0){this.uplot.redraw(e,t)}getSeriesById(e){return this.uplot.series[this.state.y2uIdx[e]]}dispose(){this.resizeOb&&this.resizeOb.unobserve(this.root),this.unsubscribe(),this.plugins?.tooltip?.dispose(),this.plugins?.legend?.destroy(),this.uplot.destroy(),this._uHooks={},this.execHooks("dispose",{chart:this})}toDataUrl(){return this.canvas.toDataURL("img/png")}subscribe(){this.state.subscribed||(this.utils.sync?.sub(this.uplot),this.state.subscribed=!0)}unsubscribe(){this.utils.sync?.unsub(this.uplot),this.state.subscribed=!1}inStage(e,t){this.state.stage,this.execHooks("stage",{chart:this,stage:e});try{t&&t()}catch(s){console.error(s),this.onError(s)}return this}initTitle(){if(this.config.title&&this.config.title.fontSize){const e=this.config.title.fontSize,t=this.root.querySelector(".u-title");t.setAttribute("style",`font-size:${e}px;line-height:${e}px;`),t.innerHTML=this.config.title.text}}onError(e){return this.execHooks("error",{stage:this.state.stage,error:e,chart:this}),e}trackMouse(){const e=()=>{this.state.isMouseOver=!0},t=()=>{this.state.isMouseOver=!1};return this.root.addEventListener("mouseover",e),this.root.addEventListener("mouseleave",t),()=>{this.root.removeEventListener("mouseover",e),this.root.removeEventListener("mouseleave",t)}}get clientHeight(){const t=this.config.title.text?(this.config.title.fontSize||Bn)+8:0;return this.root.clientHeight-t-(this.plugins.legend?.state.totalSpace||0)}reflow(e=!0){const t=this.root.clientWidth,s=this.clientHeight;this._cache.width=t,this.options.width=t,this._cache.height=s,this.options.height=s,e&&this.uplot.setSize({width:this.options.width,height:this.options.height}),e&&this.uplot.redraw()}};Zu(lo,[zu,Vu,qu,Ju]);var ro=lo,Of=Nn;typeof window<"u"&&Object.assign(window,{Yagr:ro});var Mf=ro})();
//# sourceMappingURL=yagr.iife.min.js.map
