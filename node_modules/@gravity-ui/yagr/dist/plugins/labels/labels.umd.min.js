/**
* Copyright (c) 2024, Yandex LLC
* All rights reserved. (MIT Licensed)
*
* Yagr@4.3.0
* High-performance HTML5 canvas chart renderer based on uPlot
* https://github.com/gravity-ui/yagr
*/

"use strict";(function(E,P){var C=typeof exports=="object";if(typeof define=="function"&&define.amd)define([],P);else if(typeof module=="object"&&module.exports)module.exports=P();else{var T=P(),S=C?exports:E;for(var O in T)S[O]=T[O]}})(typeof self<"u"?self:this,()=>{var E={},P={exports:E},C=Object.defineProperty,T=Object.getOwnPropertyDescriptor,S=Object.getOwnPropertyNames,O=Object.prototype.hasOwnProperty,M=(r,t)=>{for(var l in t)C(r,l,{get:t[l],enumerable:!0})},H=(r,t,l,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let c of S(t))!O.call(r,c)&&c!==l&&C(r,c,{get:()=>t[c],enumerable:!(n=T(t,c))||n.enumerable});return r},W=r=>H(C({},"__esModule",{value:!0}),r),N={};M(N,{default:()=>B}),P.exports=W(N);var b=r=>r+"px",V=(r,t={},l)=>{const n=document.createElement(r);return Object.keys(t).forEach(c=>{const p=t[c];n.setAttribute(c,typeof p=="object"?Object.entries(p).map(([u,f])=>`${u}:${f}`).join(";"):p)}),l&&(typeof l=="string"?n.innerHTML=l:n.appendChild(l)),n};function A(r){return r==null}var D=(r,t,l,n)=>[r.valToPos(t,"x"),r.valToPos(l,n)-15],_=()=>r=>String(r);function q({yagr:r,scaleKey:t,x:l,y:n,className:c="",render:p,onRender:u,onDestroy:f,label:d}){const e=r.root.querySelector(".u-over");if(p)return p(r,l,n,d);const o=d.label?typeof d.label=="function"?d.label(d):d.label:"",s=V("div",{class:`yagr-label ${c}`,style:{visibility:"hidden"}},o??d.value.toString());return e.append(s),t==="x"?(s.style.top=b(n-s.clientHeight/2),s.style.left=b(l-s.clientWidth/2)):(r.config.axes[t]?.side==="right"?s.style.left=b(l-s.clientWidth/2):s.style.left=b(l),s.style.top=b(n-s.clientHeight/2)),s.style.visibility="visible",u&&u(s),()=>{f&&f(s),s.remove()}}function $({yagr:r,label:t,x:l,y:n,className:c="",shifts:p={},onRender:u,onDestroy:f}){const d=r.root.querySelector(".u-over"),e=V("div",{class:`yagr-label ${c}`,style:{top:b(n+(p.top||0)),left:b(l+(p.left||0))}},t);return d.append(e),u&&u(e),e.style.left=b(Number(e.style.left.replace("px",""))-e.clientWidth/2),()=>{e.remove(),f&&f(e)}}function F(r,t,l,n,c,p,u,f){const d=r.uplot.data[0][l],e=r.uplot.data[t][l];if(A(e)||!n||!c)return;const o=p(d),s=u(e),a=typeof c.label=="function"?c.label(d,e,l):c.label||`(${o}, ${s})`;if(c.render){const L=c.render(r,t,l,n,c);L&&f&&f(L,a??"",t);return}if(!a||A(e))return;const[i,x]=c.position?c.position(d,e):D(r.uplot,d,e,n),v=r.uplot.data[t][l-1],w=r.uplot.data[t][l+1],m=v!=null&&w!==null&&w!==void 0&&e<v&&e<w?"_bottom":"_top";let y=()=>{};c.show!==!1&&(y=$({yagr:r,label:a,x:i,y:x,className:m,onRender:c.onRender,onDestroy:c.onDestroy})),f&&f(y,a,t)}function R(r,t,l){const n={},c=[],p=[],u={};t.drawClear=t.drawClear||[],t.draw=t.draw||[],t.setCursor=t.setCursor||[],t.setSeries=t.setSeries||[];function f(e,o){const s=[];if(o)s.push(...o);else for(let a=1;a<e.series.length;a++){const i=e.series[a];if(l.scales?.draw){const x=i.scale;x&&l.scales?.draw[x]&&s.push(a)}l.series?.draw&&l.series?.draw[i.id]&&s.push(a)}for(const a of s){const i=e.series[a];if(!i.show||i._focus===!1)continue;const{scale:x="y",min:v,max:w}=i,m=e.series[0],y=l.series?.draw?.[i.id]||l.scales?.draw?.[i.scale],L=(e.axes.find(g=>g.scale===x)?.getFormatter||_)(w-v),j=(e.axes.find(g=>g.scale==="x")?.getFormatter||_)(m.max-m.min);let h=0;for(;h<e.data[0].length;)F(r,a,h,x,y,j,L,(g,z)=>{n[a]=n[a]||[],n[a].push(g),u[a]=u[a]||[],u[a].push({idx:h,label:z})}),h++}}function d(e,o){const s=[];for(let a=1;a<e.series.length;a++){const i=e.series[a];if(l.scales?.cursor){const x=i.scale;x&&l.scales.cursor[x]&&s.push(a)}l.series?.cursor&&l.series.cursor[i.id]&&s.push(a)}for(const a of s){const i=e.series[a];if(!i.show||i._focus===!1)continue;const{scale:x="y",min:v,max:w}=i,m=e.series[0],y=l.series?.cursor?.[i.id]||l.scales?.cursor?.[i.scale],L=(e.axes.find(h=>h.scale===x)?.getFormatter||_)(w-v),j=(e.axes.find(h=>h.scale==="x")?.getFormatter||_)(m.max-m.min);F(r,a,o,x,y,j,L,h=>{c.push(h)})}}return l.series?.focus&&t.setSeries.push((e,o,s)=>{if(o===null){p?.forEach(x=>x());return}const a=e.series[o],i=l.series?.focus?.[a.id];if(!i){p?.forEach(x=>x());return}if(a.show&&s.focus===!0){const{scale:x="y",min:v,max:w}=a,m=e.series[0],y=(e.axes.find(h=>h.scale===x)?.getFormatter||_)(w-v),L=(e.axes.find(h=>h.scale==="x")?.getFormatter||_)(m.max-m.min);let j=0;for(;j<e.data[0].length;)F(r,o,j,x,i,L,y,h=>{p.push(h)}),j++}else p?.forEach(x=>x())}),(l.scales?.draw||l.series?.draw)&&(t.draw.push(e=>{f(e)}),t.drawClear.push(()=>{Object.values(n).forEach(e=>e.forEach(o=>o())),Object.keys(n).forEach(e=>delete n[Number(e)])})),(l.scales?.cursor||l.series?.cursor)&&t.setCursor.push(e=>{c.forEach(s=>s());const{idx:o}=e.cursor;A(o)||d(e,o)}),{getSeriesLabels:()=>u,getCurrentSeriesLabels:()=>{const e=r.uplot.cursor;return e.idx===null?{}:Object.entries(u).reduce((o,[s,a])=>(o[Number(s)]=a.find(i=>i.idx===e.idx),o),{})}}}function Y(r,t,l){let n=[],c=[];t.draw=t.draw||[],t.drawClear=t.drawClear||[],t.setCursor=t.setCursor||[];function p(u,f,d){const e=[];for(const[o,s]of Object.entries(u||{})){const a=(r.plugins.plotLines?.get()||[]).filter(i=>i.scale===o);a.length&&e.push({bands:a,labelOptions:s})}e.length&&e.forEach(({bands:o,labelOptions:s})=>{o.forEach(a=>{if(d?.(a)===!1)return;const[i,x]=a.scale==="x"?[Array.isArray(a.value)?a.value[0]:a.value,r.uplot.posToVal(0,"y")]:[r.uplot.posToVal(0,"x"),Array.isArray(a.value)?a.value[0]:a.value],[v,w]=s.position?s.position(i,x):D(r.uplot,i,x,a.scale||"y"),m=typeof s.label=="function"?s.label(a):s.label||a.label;if(s.render){const y=s.render(r,a,v,w,s);y&&n.push(y);return}m&&s.show!==!1&&f.push($({yagr:r,label:m,x:v,y:w}))})})}return l.plotLines?.cursor&&t.setCursor.push(u=>{c.forEach(e=>e()),c=[];const{left:f,top:d}=u.cursor;!A(f)&&!A(d)&&f>=0&&d>=0&&p(l.plotLines?.cursor,c,e=>{const o=r.uplot.posToVal(f,"x"),[s,a]=Array.isArray(e.value)?e.value:[e.value,e.value],[i,x]=Array.isArray(e.value)?[e.value[0],e.value[1]]:[e.value,e.value];if(e.scale==="x"){if(o>=s&&o<=a)return!0}else{const v=r.uplot.posToVal(d,e.scale);if(v>=i&&v<=x)return!0}return!1})}),l.plotLines?.draw&&(t.draw.push(()=>{p(l.plotLines?.draw,n)}),t.drawClear.push(()=>{n.forEach(u=>u()),n=[]})),{getPlotLinesLabels:()=>(r.plugins.plotLines?.get()||[]).filter(f=>l.plotLines?.draw?.[f.scale||"y"]).map(f=>({band:f,label:l.plotLines?.draw?.[f.scale||"y"]?.label||f.label})),getCurrentPlotLinesLabels:()=>{const u=r.uplot.cursor;if(!u.left||!u.top||u.left<0||u.top<0)return[];const f=[],{left:d,top:e}=u,o=r.uplot.posToVal(d,"x");return r.plugins.plotLines?.get().forEach(s=>{const[a,i]=Array.isArray(s.value)?s.value:[s.value,s.value],[x,v]=Array.isArray(s.value)?[s.value[0],s.value[1]]:[s.value,s.value];if(s.scale==="x")o>=a&&o<=i&&f.push({band:s,label:s.label});else{const w=r.uplot.posToVal(e,s.scale);w>=x&&w<=v&&f.push({band:s,label:s.label})}}),f}}}function J(r,t,l){let n=[];function c(p){n.forEach(u=>u()),n=[],Object.entries(l.axes||{}).forEach(([u,f])=>{p.axes.find(e=>e.scale===u)&&f.forEach(e=>{let o,s;u==="x"?(o=p.valToPos(e.value,"x"),s=p.valToPos(0,"y")):(r.config.axes[u]?.side==="right"?o=p.valToPos(p.data[0][p.data[0].length-1],"x"):o=p.valToPos(p.data[0][0],"x"),s=p.valToPos(e.value,"y")),n.push(q({yagr:r,scaleKey:u,x:o,y:s,render:e.render,label:e,className:e.className,onRender:e.onRender,onDestroy:e.onDestroy}))})})}return t.drawAxes=t.drawAxes||[],l.axes&&t.drawAxes.push(c),{getAxisLabels(){return l.axes||{}},getCurrentAxisLabels(p){const u=r.uplot.cursor;if(!u)return{};const{left:f,top:d}=u;if(A(f)||A(d)||f<0||d<0)return{};const e={};return Object.entries(l.axes||{}).forEach(([o,s])=>{r.uplot.axes.find(i=>i.scale===o)&&s.forEach(i=>{let x,v;o==="x"?(x=r.uplot.posToVal(f,"x"),Math.abs(x-i.value)<p.x&&(e[o]=e[o]||[],e[o].push(i))):(v=r.uplot.posToVal(d,"y"),Math.abs(v-i.value)<p.y&&(e[o]=e[o]||[],e[o].push(i)))})}),e}}}function B(r){return t=>{const l={};return{...R(t,l,r),...Y(t,l,r),...J(t,l,r),uplot:{hooks:l}}}}if(typeof window<"u"&&Object.assign(window,{YagrLabelsPlugin:B}),typeof P.exports=="object"&&typeof E=="object"){var X=(r,t,l,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let c of Object.getOwnPropertyNames(t))!Object.prototype.hasOwnProperty.call(r,c)&&c!==l&&Object.defineProperty(r,c,{get:()=>t[c],enumerable:!(n=Object.getOwnPropertyDescriptor(t,c))||n.enumerable});return r};P.exports=X(P.exports,E)}return P.exports});
//# sourceMappingURL=labels.umd.min.js.map
