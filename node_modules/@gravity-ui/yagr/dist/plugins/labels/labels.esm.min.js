/**
* Copyright (c) 2024, Yandex LLC
* All rights reserved. (MIT Licensed)
*
* Yagr@4.3.0
* High-performance HTML5 canvas chart renderer based on uPlot
* https://github.com/gravity-ui/yagr
*/

"use strict";var C=t=>t+"px",F=(t,a={},r)=>{const u=document.createElement(t);return Object.keys(a).forEach(v=>{const f=a[v];u.setAttribute(v,typeof f=="object"?Object.entries(f).map(([o,n])=>`${o}:${n}`).join(";"):f)}),r&&(typeof r=="string"?u.innerHTML=r:u.appendChild(r)),u};function y(t){return t==null}var j=(t,a,r,u)=>[t.valToPos(a,"x"),t.valToPos(r,u)-15],P=()=>t=>String(t);function N({yagr:t,scaleKey:a,x:r,y:u,className:v="",render:f,onRender:o,onDestroy:n,label:d}){const e=t.root.querySelector(".u-over");if(f)return f(t,r,u,d);const i=d.label?typeof d.label=="function"?d.label(d):d.label:"",s=F("div",{class:`yagr-label ${v}`,style:{visibility:"hidden"}},i??d.value.toString());return e.append(s),a==="x"?(s.style.top=C(u-s.clientHeight/2),s.style.left=C(r-s.clientWidth/2)):(t.config.axes[a]?.side==="right"?s.style.left=C(r-s.clientWidth/2):s.style.left=C(r),s.style.top=C(u-s.clientHeight/2)),s.style.visibility="visible",o&&o(s),()=>{n&&n(s),s.remove()}}function b({yagr:t,label:a,x:r,y:u,className:v="",shifts:f={},onRender:o,onDestroy:n}){const d=t.root.querySelector(".u-over"),e=F("div",{class:`yagr-label ${v}`,style:{top:C(u+(f.top||0)),left:C(r+(f.left||0))}},a);return d.append(e),o&&o(e),e.style.left=C(Number(e.style.left.replace("px",""))-e.clientWidth/2),()=>{e.remove(),n&&n(e)}}function S(t,a,r,u,v,f,o,n){const d=t.uplot.data[0][r],e=t.uplot.data[a][r];if(y(e)||!u||!v)return;const i=f(d),s=o(e),l=typeof v.label=="function"?v.label(d,e,r):v.label||`(${i}, ${s})`;if(v.render){const A=v.render(t,a,r,u,v);A&&n&&n(A,l??"",a);return}if(!l||y(e))return;const[c,x]=v.position?v.position(d,e):j(t.uplot,d,e,u),p=t.uplot.data[a][r-1],w=t.uplot.data[a][r+1],m=p!=null&&w!==null&&w!==void 0&&e<p&&e<w?"_bottom":"_top";let L=()=>{};v.show!==!1&&(L=b({yagr:t,label:l,x:c,y:x,className:m,onRender:v.onRender,onDestroy:v.onDestroy})),n&&n(L,l,a)}function $(t,a,r){const u={},v=[],f=[],o={};a.drawClear=a.drawClear||[],a.draw=a.draw||[],a.setCursor=a.setCursor||[],a.setSeries=a.setSeries||[];function n(e,i){const s=[];if(i)s.push(...i);else for(let l=1;l<e.series.length;l++){const c=e.series[l];if(r.scales?.draw){const x=c.scale;x&&r.scales?.draw[x]&&s.push(l)}r.series?.draw&&r.series?.draw[c.id]&&s.push(l)}for(const l of s){const c=e.series[l];if(!c.show||c._focus===!1)continue;const{scale:x="y",min:p,max:w}=c,m=e.series[0],L=r.series?.draw?.[c.id]||r.scales?.draw?.[c.scale],A=(e.axes.find(T=>T.scale===x)?.getFormatter||P)(w-p),E=(e.axes.find(T=>T.scale==="x")?.getFormatter||P)(m.max-m.min);let h=0;for(;h<e.data[0].length;)S(t,l,h,x,L,E,A,(T,V)=>{u[l]=u[l]||[],u[l].push(T),o[l]=o[l]||[],o[l].push({idx:h,label:V})}),h++}}function d(e,i){const s=[];for(let l=1;l<e.series.length;l++){const c=e.series[l];if(r.scales?.cursor){const x=c.scale;x&&r.scales.cursor[x]&&s.push(l)}r.series?.cursor&&r.series.cursor[c.id]&&s.push(l)}for(const l of s){const c=e.series[l];if(!c.show||c._focus===!1)continue;const{scale:x="y",min:p,max:w}=c,m=e.series[0],L=r.series?.cursor?.[c.id]||r.scales?.cursor?.[c.scale],A=(e.axes.find(h=>h.scale===x)?.getFormatter||P)(w-p),E=(e.axes.find(h=>h.scale==="x")?.getFormatter||P)(m.max-m.min);S(t,l,i,x,L,E,A,h=>{v.push(h)})}}return r.series?.focus&&a.setSeries.push((e,i,s)=>{if(i===null){f?.forEach(x=>x());return}const l=e.series[i],c=r.series?.focus?.[l.id];if(!c){f?.forEach(x=>x());return}if(l.show&&s.focus===!0){const{scale:x="y",min:p,max:w}=l,m=e.series[0],L=(e.axes.find(h=>h.scale===x)?.getFormatter||P)(w-p),A=(e.axes.find(h=>h.scale==="x")?.getFormatter||P)(m.max-m.min);let E=0;for(;E<e.data[0].length;)S(t,i,E,x,c,A,L,h=>{f.push(h)}),E++}else f?.forEach(x=>x())}),(r.scales?.draw||r.series?.draw)&&(a.draw.push(e=>{n(e)}),a.drawClear.push(()=>{Object.values(u).forEach(e=>e.forEach(i=>i())),Object.keys(u).forEach(e=>delete u[Number(e)])})),(r.scales?.cursor||r.series?.cursor)&&a.setCursor.push(e=>{v.forEach(s=>s());const{idx:i}=e.cursor;y(i)||d(e,i)}),{getSeriesLabels:()=>o,getCurrentSeriesLabels:()=>{const e=t.uplot.cursor;return e.idx===null?{}:Object.entries(o).reduce((i,[s,l])=>(i[Number(s)]=l.find(c=>c.idx===e.idx),i),{})}}}function _(t,a,r){let u=[],v=[];a.draw=a.draw||[],a.drawClear=a.drawClear||[],a.setCursor=a.setCursor||[];function f(o,n,d){const e=[];for(const[i,s]of Object.entries(o||{})){const l=(t.plugins.plotLines?.get()||[]).filter(c=>c.scale===i);l.length&&e.push({bands:l,labelOptions:s})}e.length&&e.forEach(({bands:i,labelOptions:s})=>{i.forEach(l=>{if(d?.(l)===!1)return;const[c,x]=l.scale==="x"?[Array.isArray(l.value)?l.value[0]:l.value,t.uplot.posToVal(0,"y")]:[t.uplot.posToVal(0,"x"),Array.isArray(l.value)?l.value[0]:l.value],[p,w]=s.position?s.position(c,x):j(t.uplot,c,x,l.scale||"y"),m=typeof s.label=="function"?s.label(l):s.label||l.label;if(s.render){const L=s.render(t,l,p,w,s);L&&u.push(L);return}m&&s.show!==!1&&n.push(b({yagr:t,label:m,x:p,y:w}))})})}return r.plotLines?.cursor&&a.setCursor.push(o=>{v.forEach(e=>e()),v=[];const{left:n,top:d}=o.cursor;!y(n)&&!y(d)&&n>=0&&d>=0&&f(r.plotLines?.cursor,v,e=>{const i=t.uplot.posToVal(n,"x"),[s,l]=Array.isArray(e.value)?e.value:[e.value,e.value],[c,x]=Array.isArray(e.value)?[e.value[0],e.value[1]]:[e.value,e.value];if(e.scale==="x"){if(i>=s&&i<=l)return!0}else{const p=t.uplot.posToVal(d,e.scale);if(p>=c&&p<=x)return!0}return!1})}),r.plotLines?.draw&&(a.draw.push(()=>{f(r.plotLines?.draw,u)}),a.drawClear.push(()=>{u.forEach(o=>o()),u=[]})),{getPlotLinesLabels:()=>(t.plugins.plotLines?.get()||[]).filter(n=>r.plotLines?.draw?.[n.scale||"y"]).map(n=>({band:n,label:r.plotLines?.draw?.[n.scale||"y"]?.label||n.label})),getCurrentPlotLinesLabels:()=>{const o=t.uplot.cursor;if(!o.left||!o.top||o.left<0||o.top<0)return[];const n=[],{left:d,top:e}=o,i=t.uplot.posToVal(d,"x");return t.plugins.plotLines?.get().forEach(s=>{const[l,c]=Array.isArray(s.value)?s.value:[s.value,s.value],[x,p]=Array.isArray(s.value)?[s.value[0],s.value[1]]:[s.value,s.value];if(s.scale==="x")i>=l&&i<=c&&n.push({band:s,label:s.label});else{const w=t.uplot.posToVal(e,s.scale);w>=x&&w<=p&&n.push({band:s,label:s.label})}}),n}}}function B(t,a,r){let u=[];function v(f){u.forEach(o=>o()),u=[],Object.entries(r.axes||{}).forEach(([o,n])=>{f.axes.find(e=>e.scale===o)&&n.forEach(e=>{let i,s;o==="x"?(i=f.valToPos(e.value,"x"),s=f.valToPos(0,"y")):(t.config.axes[o]?.side==="right"?i=f.valToPos(f.data[0][f.data[0].length-1],"x"):i=f.valToPos(f.data[0][0],"x"),s=f.valToPos(e.value,"y")),u.push(N({yagr:t,scaleKey:o,x:i,y:s,render:e.render,label:e,className:e.className,onRender:e.onRender,onDestroy:e.onDestroy}))})})}return a.drawAxes=a.drawAxes||[],r.axes&&a.drawAxes.push(v),{getAxisLabels(){return r.axes||{}},getCurrentAxisLabels(f){const o=t.uplot.cursor;if(!o)return{};const{left:n,top:d}=o;if(y(n)||y(d)||n<0||d<0)return{};const e={};return Object.entries(r.axes||{}).forEach(([i,s])=>{t.uplot.axes.find(c=>c.scale===i)&&s.forEach(c=>{let x,p;i==="x"?(x=t.uplot.posToVal(n,"x"),Math.abs(x-c.value)<f.x&&(e[i]=e[i]||[],e[i].push(c))):(p=t.uplot.posToVal(d,"y"),Math.abs(p-c.value)<f.y&&(e[i]=e[i]||[],e[i].push(c)))})}),e}}}function g(t){return a=>{const r={};return{...$(a,r,t),..._(a,r,t),...B(a,r,t),uplot:{hooks:r}}}}typeof window<"u"&&Object.assign(window,{YagrLabelsPlugin:g});export{g as default};
//# sourceMappingURL=labels.esm.min.js.map
