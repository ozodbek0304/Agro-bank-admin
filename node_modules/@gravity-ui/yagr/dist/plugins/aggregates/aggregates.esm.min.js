/**
* Copyright (c) 2024, Yandex LLC
* All rights reserved. (MIT Licensed)
*
* Yagr@4.3.0
* High-performance HTML5 canvas chart renderer based on uPlot
* https://github.com/gravity-ui/yagr
*/

"use strict";var A="x",R=typeof window>"u"?1:window.devicePixelRatio,U=R>=2?4:2,v=1e3,p=v*60,m=p*60,f=m*24,b=f*365,M=b*10,X=[1,10,50,100,200,500,v,v*2,v*5,v*10,v*15,v*30,p,p*5,p*10,p*30,m,m*2,m*3,m*4,m*6,m*12,f,f*2,f*3,f*5,f*10,f*15,f*30,f*60,f*120,f*180,b,b*2,b*5,b*10];function d(u,c){if(u.length<2)return 0;let o=u[0],n=Number(c[0]),l,t,e=0;for(let r=1;r<u.length;r++){if(t=Number(c[r]),l=u[r],!Number.isNaN(t)&&!Number.isNaN(n)){const s=l-o,a=t-n,i=(n+a/2)*s;e+=i}o=l,n=t}return e}function L(u,c=0,o=u.length-1){let n=0;for(let l=c;l<=o;l++)typeof u[l]=="number"&&n++;return n}function T(u,c=0,o=u.length-1){for(let n=o;n>=c;n--){const l=u[n];if(l!==null&&typeof l=="number")return l}return null}var w=(u,c=0,o=u.length-1)=>{if(u.length===0)return null;let n=null;for(let l=c;l<=o;l++){const t=u[l];t===null||typeof t=="string"||(n===null||t<n)&&(n=t)}return n},_=(u,c=0,o=u.length-1)=>{if(u.length===0)return null;let n=null;for(let l=c;l<=o;l++){const t=u[l];t===null||typeof t=="string"||(n===null||t>n)&&(n=t)}return n},O=(u,c=0,o=u.length-1)=>{if(u.length===0)return null;let n=null;for(let l=c;l<=o;l++){const t=u[l];t===null||typeof t=="string"||(n===null?n=t:n+=t)}return n},D=u=>o=>{const n={},l={get:(t,e)=>{if(t===void 0&&e===void 0)return n;t===void 0&&(t=0),e===void 0&&(e=o.uplot.data[0].length-1);const r={};return o.uplot.series.forEach(({scale:s,id:a})=>{s===A||!s||(r[s]=r[s]||{},r[s].series=r[s].series||{},r[s].series[a]=l.calc(t,e,a))}),Object.keys(r).forEach(s=>{const a={min:w(Object.values(r[s].series).map(({min:i})=>i)),max:_(Object.values(r[s].series).map(({max:i})=>i)),sum:O(Object.values(r[s].series).map(({sum:i})=>i)),avg:0,count:Object.values(r[s].series).reduce((i,{count:g})=>i+g,0),integral:Object.values(r[s].series).reduce((i,{integral:g})=>i+(g??0),0),last:0};a.avg=a.sum===null?null:a.sum/a.count,a.last=null,r[s].total=a}),r},calc:(t,e,r)=>{const s=o.state.y2uIdx[r],a=o.uplot.data[0].slice(t,e+1),i=o.uplot.series[s].$c,g=d(a,i.slice(t,e+1)),h=O(i,t,e),E=w(i,t,e),N=_(i,t,e),j=L(i,t,e),S=h===null?null:h/j,y=T(i,t,e);return{min:E,max:N,sum:h,avg:S,count:j,integral:g,last:y}},uplot:{hooks:u.calcOnReady===!1?{}:{ready:t=>{Object.keys(t.scales).forEach(e=>{e!==A&&(n[e]={min:null,max:null,sum:null,avg:null,integral:null,count:0,last:null})}),t.series.forEach(({scale:e,$c:r,count:s})=>{if(e===A)return;const a=r.filter(N=>typeof N=="number"&&N!==null);n[e].min=w([...a,n[e].min]),n[e].max=_([...a,n[e].max]);const i=n[e].sum,g=O(a);n[e].sum=i===null?O(a):g===null?i:i+g,n[e].count+=s;const h=n[e].integral,E=d(t.data[0],r);n[e].integral=h===null?E:h+E}),Object.keys(n).forEach(e=>{const r=n[e].sum;n[e].avg=r===null?null:r/n[e].count})}}}};return l},C=D;typeof window<"u"&&Object.assign(window,{YagrAggregates:D});export{C as default};
//# sourceMappingURL=aggregates.esm.min.js.map
