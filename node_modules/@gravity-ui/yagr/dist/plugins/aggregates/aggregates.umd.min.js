/**
* Copyright (c) 2024, Yandex LLC
* All rights reserved. (MIT Licensed)
*
* Yagr@4.3.0
* High-performance HTML5 canvas chart renderer based on uPlot
* https://github.com/gravity-ui/yagr
*/

"use strict";(function(m,p){var O=typeof exports=="object";if(typeof define=="function"&&define.amd)define([],p);else if(typeof module=="object"&&module.exports)module.exports=p();else{var j=p(),P=O?exports:m;for(var d in j)P[d]=j[d]}})(typeof self<"u"?self:this,()=>{var m={},p={exports:m},O=Object.defineProperty,j=Object.getOwnPropertyDescriptor,P=Object.getOwnPropertyNames,d=Object.prototype.hasOwnProperty,T=(r,u)=>{for(var i in u)O(r,i,{get:u[i],enumerable:!0})},M=(r,u,i,e)=>{if(u&&typeof u=="object"||typeof u=="function")for(let t of P(u))!d.call(r,t)&&t!==i&&O(r,t,{get:()=>u[t],enumerable:!(e=j(u,t))||e.enumerable});return r},U=r=>M(O({},"__esModule",{value:!0}),r),S={};T(S,{default:()=>Y}),p.exports=U(S);var A="x",X=typeof window>"u"?1:window.devicePixelRatio,Z=X>=2?4:2,v=1e3,_=v*60,b=_*60,f=b*24,h=f*365,q=h*10,z=[1,10,50,100,200,500,v,v*2,v*5,v*10,v*15,v*30,_,_*5,_*10,_*30,b,b*2,b*3,b*4,b*6,b*12,f,f*2,f*3,f*5,f*10,f*15,f*30,f*60,f*120,f*180,h,h*2,h*5,h*10];function R(r,u){if(r.length<2)return 0;let i=r[0],e=Number(u[0]),t,n,l=0;for(let o=1;o<r.length;o++){if(n=Number(u[o]),t=r[o],!Number.isNaN(n)&&!Number.isNaN(e)){const a=t-i,c=n-e,s=(e+c/2)*a;l+=s}i=t,e=n}return l}function k(r,u=0,i=r.length-1){let e=0;for(let t=u;t<=i;t++)typeof r[t]=="number"&&e++;return e}function F(r,u=0,i=r.length-1){for(let e=i;e>=u;e--){const t=r[e];if(t!==null&&typeof t=="number")return t}return null}var D=(r,u=0,i=r.length-1)=>{if(r.length===0)return null;let e=null;for(let t=u;t<=i;t++){const n=r[t];n===null||typeof n=="string"||(e===null||n<e)&&(e=n)}return e},x=(r,u=0,i=r.length-1)=>{if(r.length===0)return null;let e=null;for(let t=u;t<=i;t++){const n=r[t];n===null||typeof n=="string"||(e===null||n>e)&&(e=n)}return e},w=(r,u=0,i=r.length-1)=>{if(r.length===0)return null;let e=null;for(let t=u;t<=i;t++){const n=r[t];n===null||typeof n=="string"||(e===null?e=n:e+=n)}return e},C=r=>i=>{const e={},t={get:(n,l)=>{if(n===void 0&&l===void 0)return e;n===void 0&&(n=0),l===void 0&&(l=i.uplot.data[0].length-1);const o={};return i.uplot.series.forEach(({scale:a,id:c})=>{a===A||!a||(o[a]=o[a]||{},o[a].series=o[a].series||{},o[a].series[c]=t.calc(n,l,c))}),Object.keys(o).forEach(a=>{const c={min:D(Object.values(o[a].series).map(({min:s})=>s)),max:x(Object.values(o[a].series).map(({max:s})=>s)),sum:w(Object.values(o[a].series).map(({sum:s})=>s)),avg:0,count:Object.values(o[a].series).reduce((s,{count:g})=>s+g,0),integral:Object.values(o[a].series).reduce((s,{integral:g})=>s+(g??0),0),last:0};c.avg=c.sum===null?null:c.sum/c.count,c.last=null,o[a].total=c}),o},calc:(n,l,o)=>{const a=i.state.y2uIdx[o],c=i.uplot.data[0].slice(n,l+1),s=i.uplot.series[a].$c,g=R(c,s.slice(n,l+1)),y=w(s,n,l),E=D(s,n,l),N=x(s,n,l),L=k(s,n,l),H=y===null?null:y/L,J=F(s,n,l);return{min:E,max:N,sum:y,avg:H,count:L,integral:g,last:J}},uplot:{hooks:r.calcOnReady===!1?{}:{ready:n=>{Object.keys(n.scales).forEach(l=>{l!==A&&(e[l]={min:null,max:null,sum:null,avg:null,integral:null,count:0,last:null})}),n.series.forEach(({scale:l,$c:o,count:a})=>{if(l===A)return;const c=o.filter(N=>typeof N=="number"&&N!==null);e[l].min=D([...c,e[l].min]),e[l].max=x([...c,e[l].max]);const s=e[l].sum,g=w(c);e[l].sum=s===null?w(c):g===null?s:s+g,e[l].count+=a;const y=e[l].integral,E=R(n.data[0],o);e[l].integral=y===null?E:y+E}),Object.keys(e).forEach(l=>{const o=e[l].sum;e[l].avg=o===null?null:o/e[l].count})}}}};return t},Y=C;if(typeof window<"u"&&Object.assign(window,{YagrAggregates:C}),typeof p.exports=="object"&&typeof m=="object"){var V=(r,u,i,e)=>{if(u&&typeof u=="object"||typeof u=="function")for(let t of Object.getOwnPropertyNames(u))!Object.prototype.hasOwnProperty.call(r,t)&&t!==i&&Object.defineProperty(r,t,{get:()=>u[t],enumerable:!(e=Object.getOwnPropertyDescriptor(u,t))||e.enumerable});return r};p.exports=V(p.exports,m)}return p.exports});
//# sourceMappingURL=aggregates.umd.min.js.map
